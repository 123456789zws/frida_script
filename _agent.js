📦
4332 /src/index.js.map
12349 /src/index.js
11 /src/index.d.ts
62 /src/java/abstract.d.ts
1279 /src/java/abstract.js.map
1284 /src/java/abstract.js
43 /src/java/file.d.ts
1023 /src/java/file.js.map
1013 /src/java/file.js
45 /src/java/stringBuilder.d.ts
837 /src/java/stringBuilder.js.map
1440 /src/java/stringBuilder.js
245 /src/java/trace.d.ts
13569 /src/java/trace.js.map
19345 /src/java/trace.js
139 /src/java/trace_change.d.ts
4634 /src/java/trace_change.js.map
6558 /src/java/trace_change.js
300 /src/so/BufferUtils.d.ts
2335 /src/so/BufferUtils.js.map
2118 /src/so/BufferUtils.js
56 /src/so/all_so.d.ts
754 /src/so/all_so.js.map
714 /src/so/all_so.js
138 /src/so/hook_func.d.ts
2298 /src/so/hook_func.js.map
3084 /src/so/hook_func.js
57 /src/so/hook_str.d.ts
1328 /src/so/hook_str.js.map
1921 /src/so/hook_str.js
44 /src/so/init_array.d.ts
2336 /src/so/init_array.js.map
2346 /src/so/init_array.js
137 /src/so/inlinehook.d.ts
2236 /src/so/inlinehook.js.map
3009 /src/so/inlinehook.js
11 /src/so/scan.d.ts
381 /src/so/scan.js.map
972 /src/so/scan.js
53 /src/so/sktrace/sktrace.d.ts
4041 /src/so/sktrace/sktrace.js.map
6366 /src/so/sktrace/sktrace.js
53 /src/so/so_info.d.ts
779 /src/so/so_info.js.map
465 /src/so/so_info.js
58 /src/so/so_method.d.ts
924 /src/so/so_method.js.map
773 /src/so/so_method.js
50 /src/so/socket.d.ts
3238 /src/so/socket.js.map
3716 /src/so/socket.js
146 /src/so/stalker.d.ts
5045 /src/so/stalker.js.map
7659 /src/so/stalker.js
369 /src/so/utils.d.ts
4936 /src/so/utils.js.map
8016 /src/so/utils.js
43 /src/utils/anti_frida.d.ts
10305 /src/utils/anti_frida.js.map
11440 /src/utils/anti_frida.js
634 /src/utils/log.d.ts
3462 /src/utils/log.js.map
3733 /src/utils/log.js
✄
{"version":3,"file":"index.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/index.ts"],"names":[],"mappings":"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"}
✄
import { trace } from "./java/trace.js";
import { nativeHookFunction } from "./so/utils.js";
import { log } from "./utils/log.js";
// import {findClass} from './java/findClass.js'
// import {all_java} from './java/all_java.js'
Java.perform(function () {
    // import { one_instance } from "./java/one_instance.js"
    // import { encryption } from "./java/encryption.js"
    // import { findClass } from "./java/findClass.js"
    // import {anti_InMemoryDexClassLoader} from './java/anti_InMemoryDexClassLoader';
    // native层
    // so_method('libAppGuard.so')
    // setTimeout(all_so,5000)
    // so_info('libAppGuard.so')
    // inline_hook('libOnLoad.so',0x9E0)
    // init_array()
    // scan()
    // all_so(false)
    // hook_func('libc.so','openat')
    // native_trace("libnativeLib.so",0x1208,0x14d);
    // native_print("libunity.so",0x9b4420,0x228)
    // native_print("libunity.so",0x9b4500)
    // monitorStrings("libunity.so")
    // sktrace('libnativeLib.so')
    // hookNativeSocket()
    // hook_dlopen('libunity.so',hook_str)
    // hook_str("openid")
    //java
    // setTimeout(() => {
    //     trace('SSLOutputStream')
    // }, 500);
    // trace('com.android.org.conscrypt.ConscryptFileDescriptorSocket$SSLOutputStream','write')
    // trace('android.content.res.ResourcesImpl')
    // trace("java.util.HashMap")
    // trace("org.json.JSONObject")
    // trace('java.io.BufferedOutputStream','write')
    // trace('dalvik.system.DexFile','loadDex')
    // trace('dalvik.system.BaseDexClassLoader')
    // trace('java.lang.Class','getDeclaredConstructor')
    // trace('java.net.InetSocketAddress')
    // trace('java.net.Socket','connect')
    // trace("java.io.BufferedReader",'readLine')
    // af相关
    // setTimeout(() => {
    //     trace('com.appsflyer.internal.AFa1uSDK')
    //     // trace("com.shopee.plugins.accountfacade.data.model.UserInfo",'setUserId')
    // },2000);
    // trace('com.appsflyer.internal.AFa1vSDK$9249')
    // trace('com.appsflyer.internal.AFa1uSDK')
    // trace("com.shopee.plugins.accountfacade.data.model.UserInfo",'setUserId')
    // trace("javax.crypto.spec.SecretKeySpec")
    // trace('java.lang.Class','getResourceAsStream')
    // af iaa
    // trace("com.appsflyer.adrevenue.adnetworks.AFWrapper")
    // trace("com.appsflyer.adrevenue.AppsFlyerAdRevenue")
    // trace("com.appsflyer.adrevenue.data.model.AppsFlyerAdEvent")
    // trace("com.unity3d.services.core.api.Sdk")
    // 最详细的日志
    // trace("com.unity3d.services.core.log.DeviceLog")
    // 解密类
    // trace("com.ironsource.ri")
    // 竞价过程类
    // trace("com.ironsource.f5")
    // 网络请求类
    // trace("com.vungle.ads.internal.network.VungleApiClient")
    // 播放视频
    // trace("com.unity3d.services.ads.api.VideoPlayer")
    // trace('com.ironsource.mediationsdk.e')
    trace("com.delta.msdk.DidManager");
    // hook_abstract("com.anythink.rewardvideo.unitgroup.api.CustomRewardVideoAdapter")
    // trace("com.anythink.network.unityads.UnityAdsATInterstitialAdapter")
    // trace("com.anythink.core.common.l.a$1")
    // 抽象类，hook没用
    // trace("java.net.URL",'openConnection')
    // trace("com.android.server.am.BroadcastQueue",'finishReceiverLocked')
    // trace("java.io.InputStreamReader",'11111')
    // ---------------常用java类-------------
    // trace('dalvik.system.DexPathList')
    // trace('dalvik.system.DexClassLoader')
    // trace('dalvik.system.BaseDexClassLoader')
    // ---------------mlbb日志-------------
    // mlbb的日志-1
    // trace("com.ss.android.common.util.b")
    // mlbb的日志-2
    // trace('com.ss.android.common.applog.AppLog')
    // 发送日志加密类
    // trace('com.ss.android.common.applog.NetUtil')
    // 日志发送的请求类
    // trace("gsdk.impl.crash.isolate.b")
    // trace('com.adjust.sdk.AdjustConfig')
    // trace('com.adjust.sdk.network.ActivityPackageSender')
    // trace('com.moba.unityplugin.MobaGameUnityActivity')
    // trace('com.moba.unityplugin.MobaGameMainActivityWithExtractor')
    // trace("android.os.BaseBundle",'putString')
    // trace('oze')
    // mlbb的getDeviceId、getOpenUdid、getInstallId、getClientUDID
    // trace("com.ss.android.deviceregister.core.e",'getDeviceId')
    // trace('com.ss.android.deviceregister.core.cache.internal.a','a')
    // trace('com.appsflyer.internal.AFa1xSDK$AFa1zSDK$AFa1zSDK','AFInAppEventType')  
    // trace('com.appsflyer.internal.AFa1ySDK')
    // setTimeout(trace,1000,'com.appsflyer.internal.AFa1ySDK')
    // setTimeout(trace,3000,'com.alibaba.minilibc.android.MtopMethodJniBridge')
    // all_java('com.alibaba.minilibc.android.MtopMethodJniBridge')
    // setTimeout(all_java,5000)
    // findClass()
    // hook_file()
    // trace('com.alibaba.wireless.security.open.SecException')
    trace('com.delta.msdk.DidManager');
    // setTimeout(trace,1000,'com.appsflyer.internal.AFa1xSDK$AFa1wSDK','values')
    // hook_hashmap()
    // trace('java.util.HashMap','put')
    // trace('ava.lang.reflect.Method','invoke')
    // hook_string()
    // encryption()
    // anti_InMemoryDexClassLoader()
    // antiFrida()
    // native_hook()
    function native_hook() {
        nativeHookFunction(function (args, context, retval, base_addr, hook_addr, currentThreadId) {
            try {
                // onEnter回调函数体
                console.log("进入函数");
                // var module = Process.findModuleByName("libunity.so"); 
                //   //??是通配符
                //   var pattern = "62 35 39 66 65 61 66 36 37 39 63 63 34 34 39 39 63 62 31 31 30 39 32 30 38 61 64 34 61 36 35 61";
                //   //基址
                //   //从so的基址开始搜索，搜索大小为so文件的大小，搜指定条件03 49 ?? 50 20 44的数据
                //   var res = Memory.scan(module.base, module.size, pattern, {
                //       onMatch: function(address, size){
                //           //搜索成功
                //           console.log('搜索到 ' +pattern +" 地址是:"+ address.toString());  
                //       }, 
                //       onError: function(reason){
                //           //搜索失败
                //           // console.log('搜索失败');
                //       },
                //       onComplete: function()
                //       {
                //           //搜索完毕
                //           // console.log("搜索完毕")
                //       }
                //     });
                //   console.log(hexdump(ptr(args[1]), {
                //     length: 50,
                //     header: false,
                //     ansi: true
                // }))
                // var targetAddr = context.x19.add(0xc28);
                // var memValue = Memory.readU64(targetAddr);
                // hexdumpAdvanced(ptr(memValue))
                // var targetAddr = context.x0.add(0x670);
                // var memValue = Memory.readU64(targetAddr);
                // hexdumpAdvanced(ptr(memValue))
                // hexdumpAdvanced(context.x0);
                // log(stacktrace_so(context))
                // Memory.protect(context.x0, 0x1000, 'rwx');
                // MemoryAccessMonitor.enable({base: context.x0, size: 0x1000},
                //   {onAccess: function (details) {
                //     if (details.operation === 'write') {
                //       // 输出偏移地址
                //       log("写入的偏移地址："+details.address.sub(base_addr));
                //       log("写入来源："+details.source);
                //       log("写入调用堆栈"+stacktrace_so(context))
                //       log("写入内存"+hexdumpAdvanced(details.address))
                //     }
                //   }}
                // );
                //   MemoryAccessMonitor.attach(function (details) {
                //     if (details.operation === 'write' && details.address.equals(base_addr.add(context.x0))) {
                //         console.log('写入内存:', details.address, details.size, details.data);
                //     }
                // }
                // );  
                // var start_address = base_addr.add(0x348e18);  // 模块基址
                // var end_address = base_addr.add(0x348f98);  // 相对于基址的偏移
                Stalker.follow(this.tid, {
                    events: {
                        // 禁用所有事件，减少崩溃风险
                        call: false,
                        ret: false,
                        exec: false,
                        block: false,
                        compile: false
                    },
                    transform(iterator) {
                        do {
                            var instruction = iterator.next();
                            if (instruction === null)
                                return; // 安全检查
                            const startAddress = instruction.address;
                            // 确保地址在有效范围内
                            const isModuleCode = startAddress.compare(start_address) >= 0 &&
                                startAddress.compare(end_address) < 0;
                            if (isModuleCode) {
                                console.log("startAddress: 0x" + startAddress.sub(base_addr).toString(16));
                                //这里是寄存器变化时调用
                                iterator.putCallout((context) => {
                                    log(JSON.stringify(context));
                                    // log("x0:"+hexdumpAdvanced(context.x0));
                                    // log("x1:"+hexdumpAdvanced(context.x1));
                                });
                            }
                            if (instruction !== null) {
                                iterator.keep();
                            }
                        } while (instruction !== null);
                    }
                });
                // for(var i=0;i<=7;i++){
                //   var reg = "x"+i;
                //   hexdumpAsciiOnly(ptr(context[reg]));
                // }
                // hexdumpAsciiOnly(context.x4)
                // hexdumpAdvanced(ptr(Memory.readU64(ptr(context.x0))))
                // hexdumpAdvanced(context.x0)
                // log(hexdumpAdvanced(context.x1))
                // log(hexdumpAdvanced(context.x2))
                // log(Memory.readCString(context.X1))
                // log(Memory.readCString(args[0]))
                // log(Memory.readCString(args[1]))
                // log(Memory.readCString(args[2]))
                // hexdumpAdvanced(context.x1);
                // hexdumpAdvanced(context.x3);
                // hexdumpAdvanced(context.x25);
                // var address = base_addr.add(0x11ad1b8);
                // // log("address:"+Memory.readCString(address));
                // log("address:"+hexdumpAdvanced(address));
                // printRegisters(context,["x8"]);
                // printRegisters(context);
                // var funcName = "memcpy";
                // const address = Module.findExportByName(null, funcName);
                // Interceptor.attach(address, {
                //   onEnter: function(args) {
                //       const sourceStr = Memory.readUtf8String(args[1]);
                //       log(`[${funcName}] 字符串内容: ${sourceStr}`);
                //   },
                //   onLeave: function(retval) {
                //   }
                // });
            }
            catch (e) {
                log("Error in onEnter: " + e.message);
            }
        }, function (retval, context, args, base_addr, hook_addr) {
            // onLeave回调函数体
            // 处理返回值
            // console.log(hexdump(ptr(retval), {
            //     length: 50,
            //     header: false,
            //     ansi: true,
            //     ascii: false,
            //     format: 'linear'
            // }))
        }, "libnativeLib.so", // so_name参数
        0x1660
        // 0x9eaae4
        // 0x348ed0
        // 0x4818b8
        // 0x9b44d0    // 请求参数
        // 0x9b443c     // 都是请求
        );
    }
});
✄
export {};

✄
export declare function hook_abstract(class_name: any): void;

✄
{"version":3,"file":"abstract.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/java/abstract.ts"],"names":[],"mappings":"AAAA,aAAa;AACb,OAAO,EAAE,KAAK,EAAE,MAAM,YAAY,CAAC;AACnC,OAAO,EAAE,GAAG,EAA6C,MAAM,iBAAiB,CAAC;AAEjF,MAAM,UAAU,aAAa,CAAC,UAAU;IACpC,IAAI,CAAC,qBAAqB,CAAC;QACvB,OAAO,EAAE,UAAS,MAAM;YACpB,IAAI;gBACA,IAAI,MAAM,CAAC,SAAS,CAAC,UAAU,CAAC,EAAE;oBAC9B,GAAG,CAAC,6BAA6B,GAAG,MAAM,CAAC,CAAC;oBAC5C,IAAI,CAAC,YAAY,CAAC,MAAM,GAAG,MAAM,CAAC;iBACrC;aACJ;YAAC,OAAM,KAAK,EAAE,GAAE;QACrB,CAAC;QACD,UAAU,EAAE,cAAY,CAAC;KAC5B,CAAC,CAAC;IAEH,IAAI,CAAC,sBAAsB,CAAC;QACxB,OAAO,EAAE,UAAS,SAAS;YACvB,IAAI;gBACA,IAAI,SAAS,GAAG,SAAS,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACrC,IAAI,WAAW,GAAG,UAAU,CAAC,KAAK,CAAC,GAAG,CAAC,CAAC;gBACxC,IAAI,SAAS,CAAC,CAAC,CAAC,KAAK,WAAW,CAAC,CAAC,CAAC,IAAI,SAAS,CAAC,CAAC,CAAC,KAAK,WAAW,CAAC,CAAC,CAAC;oBAAE,OAAO;gBAE/E,IAAI,KAAK,GAAG,IAAI,CAAC,GAAG,CAAC,SAAS,CAAC,CAAC;gBAChC,IAAI,WAAW,GAAG,KAAK,CAAC,KAAK,CAAC,aAAa,EAAE,CAAC;gBAC9C,IAAI,WAAW,IAAI,WAAW,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,UAAU,CAAC,KAAK,CAAC,CAAC,EAAE;oBAClE,GAAG,CAAC,SAAS,EAAE,WAAW,CAAC,CAAC;oBAC5B,KAAK,CAAC,WAAW,CAAC,CAAC;iBACtB;aACJ;YAAC,OAAM,CAAC,EAAE,GAAE;QACjB,CAAC;QACD,UAAU,EAAE;YACR,GAAG,CAAC,yBAAyB,CAAC,CAAC;QACnC,CAAC;KACJ,CAAC,CAAC;AACN,CAAC"}
✄
//@ts-nocheck
import { trace } from "./trace.js";
import { log } from "../utils/log.js";
export function hook_abstract(class_name) {
    Java.enumerateClassLoaders({
        onMatch: function (loader) {
            try {
                if (loader.findClass(class_name)) {
                    log("Successfully found loader: " + loader);
                    Java.classFactory.loader = loader;
                }
            }
            catch (error) { }
        },
        onComplete: function () { }
    });
    Java.enumerateLoadedClasses({
        onMatch: function (className) {
            try {
                var nameParts = className.split(".");
                var targetParts = class_name.split(".");
                if (nameParts[0] !== targetParts[0] || nameParts[1] !== targetParts[1])
                    return;
                var clazz = Java.use(className);
                var resultClass = clazz.class.getSuperclass();
                if (resultClass && resultClass.toString().indexOf(class_name) !== -1) {
                    log(className, resultClass);
                    trace(resultClass);
                }
            }
            catch (e) { }
        },
        onComplete: function () {
            log("Search Class Completed!");
        }
    });
}
✄
export declare function hook_file(): void;

✄
{"version":3,"file":"file.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/java/file.ts"],"names":[],"mappings":"AAGA,MAAM,UAAU,SAAS;IACrB,IAAI,CAAC,OAAO,CAAC;QACT,IAAI,IAAI,GAAG,IAAI,CAAC,GAAG,CAAC,cAAc,CAAC,CAAC;QAEpC,gBAAgB;QAChB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,kBAAkB,CAAC,CAAC,cAAc,GAAG,UAAU,IAAI;YACnE,OAAO,CAAC,GAAG,CAAC,iCAAiC,GAAG,IAAI,CAAC,CAAC;YAEtD,IAAG;gBACC,IAAI,SAAS,GAAI,IAAI,CAAC,OAAO,CAAC,IAAI,CAAC,IAAI,CAAC,CAAC;gBACzC,QAAQ;gBACR,OAAO,CAAC,GAAG,CAAC,aAAa,GAAE,SAAS,CAAC,CAAC;aACzC;YAAA,OAAM,CAAC,EAAC;gBACL,iBAAiB;aACpB;YAED,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,IAAI,CAAC,CAAC;QACvC,CAAC,CAAC;QAEF,gBAAgB;QAChB,IAAI,CAAC,KAAK,CAAC,QAAQ,CAAC,kBAAkB,EAAE,kBAAkB,CAAC,CAAC,cAAc,GAAG,UAAU,OAAO,EAAE,QAAQ;YACpG,OAAO,CAAC,GAAG,CAAC,oCAAoC,GAAG,OAAO,GAAG,cAAc,GAAG,QAAQ,CAAC,CAAC;YAExF,QAAQ;YACR,OAAO,CAAC,GAAG,CAAC,aAAa,GAAG,QAAQ,CAAC,CAAC;YAEtC,OAAO,IAAI,CAAC,KAAK,CAAC,IAAI,CAAC,IAAI,EAAE,OAAO,EAAE,QAAQ,CAAC,CAAC;QACpD,CAAC,CAAC;IACN,CAAC,CAAC,CAAC;AACP,CAAC"}
✄
export function hook_file() {
    Java.perform(function () {
        var File = Java.use('java.io.File');
        // Hook File构造函数
        File.$init.overload('java.lang.String').implementation = function (path) {
            console.log('File constructor hooked, path: ' + path);
            try {
                var file_name = this.getName.call(this);
                // 输出文件名
                console.log('File name: ' + file_name);
            }
            catch (e) {
                // console.log(e)
            }
            return this.$init.call(this, path);
        };
        // Hook File构造函数
        File.$init.overload('java.lang.String', 'java.lang.String').implementation = function (dirPath, fileName) {
            console.log('File constructor hooked, dirPath: ' + dirPath + ', fileName: ' + fileName);
            // 输出文件名
            console.log('File name: ' + fileName);
            return this.$init.call(this, dirPath, fileName);
        };
    });
}
✄
export declare function hook_string(): void;

✄
{"version":3,"file":"stringBuilder.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/java/stringBuilder.ts"],"names":[],"mappings":"AAGA,MAAM,UAAU,WAAW;IAE3B,2DAA2D;IACzD,oFAAoF;IACpF,qBAAqB;IACrB,kFAAkF;IAClF,0EAA0E;IAC1E,mCAAmC;IACnC,0CAA0C;IAC1C,kFAAkF;IAClF,0CAA0C;IAE1C,qBAAqB;IACrB,mCAAmC;IACnC,mBAAmB;IACnB,KAAK;IAEH,MAAM,aAAa,GAAG,IAAI,CAAC,GAAG,CAAC,yBAAyB,CAAC,CAAC;IACzD,aAAa,CAAC,QAAQ,CAAC,cAAc,GAAG;QACvC,IAAI,GAAG,GAAG,IAAI,CAAC,QAAQ,EAAE,CAAC;QAC1B,IAAI,GAAG,GAAG,EAAE,CAAC;QACb,IAAI,GAAG,KAAK,IAAI,EAAC;YACb,GAAG,GAAG,GAAG,CAAC,QAAQ,EAAE,CAAC,OAAO,CAAC,IAAI,EAAE,EAAE,CAAC,CAAC;YACvC,OAAO,CAAC,GAAG,CAAC,GAAG,CAAC,CAAC;SACpB;QACD,OAAO,GAAG,CAAC;IACb,CAAC,CAAC;AACN,CAAC;AAED,yCAAyC;AAIzC,yFAAyF;AACzF,6CAA6C;AAC7C,0HAA0H;AAC1H,wCAAwC;AACxC,uBAAuB;AACvB,kCAAkC;AAClC,SAAS;AACT,IAAI"}
✄
export function hook_string() {
    //   var targetClass = Java.use("java.lang.StringBuilder");
    // targetClass.append.overload('java.lang.String').implementation = function (str) {
    //   var output = '';
    //   output = output.concat("=================String.append====================");
    //   output = output.concat("str: " + str + " => " + JSON.stringify(str));
    //   output = output.concat("\r\n")
    //   output = output.concat(stacktrace());
    //   output = output.concat("=================String.append====================");
    //   if (output.indexOf("AFa1wSDK") != -1)
    //       log(output);
    //   var retval = this.append(str);
    //   return retval;
    // };
    const StringBuilder = Java.use('java.lang.StringBuilder');
    StringBuilder.toString.implementation = function () {
        var res = this.toString();
        var tmp = "";
        if (res !== null) {
            tmp = res.toString().replace("/n", "");
            console.log(tmp);
        }
        return res;
    };
}
// export function hook_stringBuilder() {
//     StringBuilder.$init.overload('java.lang.String').implementation = function (str) {
//         var output = str.toString() + '\n'
//         output=output.concat(Java.use("android.util.Log").getStackTraceString(Java.use("java.lang.Throwable").$new()));
//         output=output.concat("\r\n");
//         log(output);
//         return this.$init(str);
//     };
// }
✄
export declare function _trace(targetClass: any, method: any): void;
export declare function findAllJavaClasses(targetClass: any, targetMethod: any, is_trace: any): void;
export declare function trace(targetClass: any, targetMethod: any): void;

✄
{"version":3,"file":"trace.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/java/trace.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
import { log, stacktrace_java } from "../utils/log.js";
function hasOwnProperty(obj, name) {
    try {
        return obj.hasOwnProperty(name) || name in obj;
    }
    catch (e) {
        return obj.hasOwnProperty(name);
    }
}
function getHandle(object) {
    if (hasOwnProperty(object, '$handle')) {
        if (object.$handle != undefined) {
            return object.$handle;
        }
    }
    if (hasOwnProperty(object, '$h')) {
        if (object.$h != undefined) {
            return object.$h;
        }
    }
    return null;
}
//查看域值
function inspectObject(obj, input) {
    var isInstance = false;
    var obj_class = null;
    if (getHandle(obj) === null) {
        obj_class = obj.class;
    }
    else {
        var Class = Java.use("java.lang.Class");
        obj_class = Java.cast(obj.getClass(), Class);
        isInstance = true;
    }
    input = input.concat("Inspecting Fields: => ", isInstance, " => ", obj_class.toString());
    input = input.concat("\n");
    var fields = obj_class.getDeclaredFields();
    for (var i in fields) {
        if (isInstance || Boolean(fields[i].toString().indexOf("static ") >= 0)) {
            // output = output.concat("\t\t static static static " + fields[i].toString());
            var className = obj_class.toString().trim().split(" ")[1];
            // console.Red("className is => ",className);
            var fieldName = fields[i].toString().split(className.concat(".")).pop();
            var fieldType = fields[i].toString().split(" ").slice(-2)[0];
            var fieldValue = undefined;
            if (!(obj[fieldName] === undefined))
                fieldValue = obj[fieldName].value;
            input = input.concat(fieldType + " \t" + fieldName + " => ", fieldValue + " => ", JSON.stringify(fieldValue));
            input = input.concat("\n");
        }
    }
    return input;
}
function bytes2hex(array) {
    // var result=Java.use("java.util.Arrays").toString();
    //把结果存到数组里
    var result = "";
    for (var i = 0; i < array.length; ++i) {
        result += array[i].charCodeAt(0);
        result += ",";
    }
    return result;
}
function print_bytes(bytes) {
    var buf = Memory.alloc(bytes.length);
    Memory.writeByteArray(buf, byte_to_ArrayBuffer(bytes));
    console.log(hexdump(buf, { offset: 0, length: bytes.length, header: false, ansi: true }));
}
//将java的数组转换成js的数组
function byte_to_ArrayBuffer(bytes) {
    var size = bytes.length;
    var tmparray = [];
    for (var i = 0; i < size; i++) {
        var val = bytes[i];
        if (val < 0) {
            val += 256;
        }
        tmparray[i] = val;
    }
    return tmparray;
}
function getReflectFields(val1, output) {
    var clazz = Java.use("java.lang.Class");
    var parametersTest = Java.cast(val1.getClass(), clazz);
    //getDeclaredFields()获取所有字段
    var fields = parametersTest.getDeclaredFields();
    fields.forEach(function (field) {
        output = output.concat("field type is: " + (field.getType()) + "\n");
        output = output.concat("field name is: " + (field.getName()) + "\n");
        output = output.concat("field value is: " + field.get(val1) + "\n");
    });
    return output;
}
function getReflectMethod(val1) {
    try {
        var clazz = Java.use("java.lang.Class");
        var parametersTest = Java.cast(val1.getClass(), clazz);
        //getDeclaredMethods()获取所有方法
        var methods = parametersTest.getDeclaredMethods();
        methods.forEach(function (method) {
            var methodName = method.getName();
            var val1Class = val1.getClass();
            var val1ClassName = Java.use(val1Class.getName());
            var overloads = val1ClassName[methodName].overloads;
            overloads.forEach(function (overload) {
                var proto = "(";
                overload.argumentTypes.forEach(function (type) {
                    proto += type.className + ", ";
                });
                if (proto.length > 1) {
                    proto = proto.substr(0, proto.length - 2);
                }
                proto += ")";
                overload.implementation = function () {
                    var args = [];
                    for (var j = 0; j < arguments.length; j++) {
                        for (var i in arguments[j]) {
                            var value = String(arguments[j][i]);
                            send(val1ClassName + "." + methodName + " and arguments value is: " + value);
                        }
                        args[j] = arguments[j] + "";
                    }
                    //打印方法参数
                    send(val1ClassName + "." + methodName + " and args is: " + args);
                    //调用方法
                    var retval = this[methodName].apply(this, arguments);
                    //打印方法返回值
                    send(methodName + " return value is: " + retval);
                    return retval; //返回方法返回值
                };
            });
        });
    }
    catch (e) {
        send("'" + val1 + "' hook fail: " + e);
    }
}
function traceMethod(targetMethod, unparseMethod) {
    log("targetMethod: " + targetMethod);
    var delim = targetMethod.lastIndexOf(".");
    var targetClass = targetMethod.slice(0, delim);
    var targetMethod = targetMethod.slice(delim + 1, targetMethod.length);
    var hook = Java.use(targetClass);
    if (!hook[targetMethod]) {
        log("Class not found: " + targetClass);
        return;
    }
    var overloadCount = hook[targetMethod].overloads.length;
    //多个函数重载会有一个问题，当参数是Object[] objArr，不能给它赋值，因此需要单独重载特定参数函数
    //     hook["values"].overload('java.lang.String', 'java.lang.String', 'int').implementation = function (str, str2, i) {
    //     console.log(`AFa1xSDK.values is called: str=${str}, str2=${str2}, i=${i}`);
    //     var result = this["values"](str, str2, i);
    //     console.log(`AFa1xSDK.values result=${result}`);
    //     return result;
    // };
    for (var i = 0; i < overloadCount; i++) {
        hook[targetMethod].overloads[i].implementation = function () {
            var output = "";
            //画个横线
            for (var p = 0; p < 100; p++) {
                output = output.concat("==");
            }
            output = output.concat("\n");
            var retval = this[targetMethod].apply(this, arguments);
            //域值
            output = inspectObject(this, output);
            // 进入函数
            output = output.concat("*********entered " + unparseMethod + "********* \n");
            for (var j = 0; j < arguments.length; j++) {
                output = output.concat("arg[" + j + "]: " + arguments[j] + " => " + JSON.stringify(arguments[j]));
                output = output.concat("\n");
            }
            //调用栈
            var stacktraceLog = stacktrace_java();
            output = output.concat(stacktraceLog);
            // //返回值
            output = output.concat("\n retval: " + retval + " => " + JSON.stringify(retval));
            output = output.concat("\n-------------------test---------------------\n");
            // 测试的地方
            // output = output.concat(print_bytes(arguments[0]));
            // 将retval转为hashmap
            // var val1 = Java.cast(retval,Java.use("java.util.HashMap"));
            // // 修改vpn_ip键的值改为''
            // val1.put("vpn_ip","");
            // retval = null;
            // log(print_hashmap(arguments[1]))
            // log(JSON.stringify(retval))
            // output = output.concat(this.e);
            // console.log('CopyOnWriteArrayList values: ' + val.size());
            //离开函数
            output = output.concat("\n ********* exiting " + targetMethod + '*********\n');
            //画个横线
            for (var p = 0; p < 100; p++) {
                output = output.concat("==");
            }
            // if(!stacktraceLog.includes("anythink")){
            //     return retval;
            // }
            log(output);
            return retval;
        };
    }
}
export function _trace(targetClass, method) {
    var hook = Java.use(targetClass);
    var output = "Tracing Class: " + hook + "\n";
    var methods = hook.class.getDeclaredMethods();
    hook.$dispose();
    var methodsDict = {};
    output += "\t\nSpec: => \n";
    methods.forEach(_method => {
        _method = _method.toString();
        output += _method + "\n";
        // 新的正则表达式匹配
        var parsedMethod = _method.match(/[\w$]+\.([a-zA-Z0-9_$]+)\(/);
        if (parsedMethod) {
            parsedMethod = parsedMethod[1];
        }
        else {
            // 如果第一种匹配失败，尝试另一种模式
            parsedMethod = _method.match(/\s([a-zA-Z0-9_$]+)\(/);
            if (parsedMethod) {
                parsedMethod = parsedMethod[1];
            }
            else {
                // 最后的备用方案
                parsedMethod = _method.split(" ").pop().split("(")[0].split(".").pop();
            }
        }
        if (method && method.toLowerCase() !== parsedMethod.toLowerCase())
            return;
        methodsDict[_method] = parsedMethod;
    });
    //添加构造函数
    var varructors = hook.class.getDeclaredConstructors();
    if (varructors.length > 0) {
        varructors.forEach(function (varructor) {
            output += "Tracing " + varructor.toString() + "\n";
        });
        //有时候hook构造函数会报错，看情况取消
        methodsDict["$init"] = '$init';
    }
    // log(output);
    //对数组中所有的方法进行hook，
    for (var unparseMethod in methodsDict) {
        var parsedMethod = methodsDict[unparseMethod];
        traceMethod(targetClass + "." + parsedMethod, unparseMethod);
    }
}
var BaseDexClassLoader = Java.use("dalvik.system.BaseDexClassLoader");
var classloader = Java.use("java.lang.ClassLoader");
var DexPathList = Java.use("dalvik.system.DexPathList");
var DexFile = Java.use("dalvik.system.DexFile");
var DexPathListElement = Java.use("dalvik.system.DexPathList$Element");
// 遍历所有类加载器并查找目标类
function findClassesInClassLoader(loader, targetClass, targetMethod, trace) {
    var pathClassLoader = Java.cast(loader, BaseDexClassLoader);
    // log("ClassLoader pathList: " + pathClassLoader.pathList.value);
    var dexPathList = Java.cast(pathClassLoader.pathList.value, DexPathList);
    // log("ClassLoader dexElements: " + dexPathList.dexElements.value.length);
    for (var i = 0; i < dexPathList.dexElements.value.length; i++) {
        var dexPathListElement = Java.cast(dexPathList.dexElements.value[i], DexPathListElement);
        if (dexPathListElement.dexFile.value) {
            var dexFile = Java.cast(dexPathListElement.dexFile.value, DexFile);
            var mCookie = dexFile.mCookie.value;
            if (dexFile.mInternalCookie.value) {
                mCookie = dexFile.mInternalCookie.value;
            }
            var classNameArr = dexPathListElement.dexFile.value.getClassNameList(mCookie);
            // log("dexFile.getClassNameList.length: " + classNameArr.length);
            for (var i = 0; i < classNameArr.length; i++) {
                var className = classNameArr[i];
                if (className.includes(targetClass)) {
                    log("Find class: " + className);
                    if (trace) {
                        Java.classFactory.loader = loader;
                    }
                }
            }
        }
    }
}
// 钩住所有的类加载器
export function findAllJavaClasses(targetClass, targetMethod, is_trace) {
    // // 第一种,不行，报错global reference table overflow,可以在返回值找到类，不能找到方法
    // var loadClass = classloader["loadClass"].overloads.length;
    // for (var i = 0; i < loadClass; i++) {
    //     classloader["loadClass"].overloads[i].implementation = function () {
    //         var retval = this["loadClass"].apply(this, arguments);
    //         var className = arguments[0];
    //         if (className.includes(targetClass)) {
    //             log("Find class: " + className);
    //             Java.classFactory.loader = this;
    //             Java.enumerateLoadedClasses({
    //                 onMatch: function (clazz) {
    //                     if (clazz.toLowerCase() == targetClass.toLowerCase()) {
    //                         log('find targetClass class: ' + clazz)
    //                         var method;
    //                         var output = "Tracing Class: " + targetClass + "\n";
    //                         var methods = retval.getDeclaredMethods()
    //                         var methodsDict = {};
    //                         output += "\t\nSpec: => \n";
    //                         methods.forEach(_method => {
    //                             _method = _method.toString()
    //                             output += _method + "\n";
    //                             var parsedMethod = _method.replace(targetClass + ".", "TOKEN").match(/\sTOKEN(.*)\(/)[1];
    //                             if (method && method.toLowerCase() !== parsedMethod.toLowerCase())
    //                             return;
    //                         methodsDict[_method] = parsedMethod;
    //                         });
    //                         //添加构造函数
    //                         var varructors = retval.getDeclaredConstructors();
    //                         if (varructors.length > 0) {
    //                             varructors.forEach(function (varructor) {
    //                                 output += "Tracing " + varructor.toString() + "\n";
    //                             })
    //                             //有时候hook构造函数会报错，看情况取消
    //                             methodsDict["$init"]='$init';
    //                         }
    //                         log(output);
    //                         //对数组中所有的方法进行hook，
    //                         for (var unparseMethod in methodsDict) {
    //                             var parsedMethod = methodsDict[unparseMethod];
    //                             traceMethod(targetClass + "." + parsedMethod, unparseMethod);
    //                         }
    //                     }
    //                 },
    //                 onComplete: function () {
    //                     log("Search Class Completed!")
    //                 }
    //             });         
    //          }
    //         return retval;
    //     }
    // }
    // jni指针错误
    // var BaseDexClassLoader = Java.use("dalvik.system.BaseDexClassLoader");
    // var loadClass = BaseDexClassLoader["findResource"].overloads.length;
    // for (var i = 0; i < loadClass; i++) {
    //     BaseDexClassLoader["findResource"].overloads[i].implementation = function () {
    //         var retval = this["findResource"].apply(this, arguments);
    //         if (arguments[0].includes("com/appsflyer/internal")) {
    //             log("Find class: "); 
    //             Java.classFactory.loader = loader;
    //             Java.enumerateLoadedClasses({
    //                 onMatch: function (clazz) {
    //                     // console.log(clazz)
    //                     if (clazz.toLowerCase().indexOf(targetClass.toLowerCase()) > -1) {
    //                         // if (clazz.toLowerCase() == targetClass.toLowerCase()) {
    //                         log('find targetClass class: ' + clazz)
    //                         targetClasses.push(clazz);
    //                         _trace(clazz,targetMethod);
    //                     }
    //                 },
    //                 onComplete: function () {
    //                     log("Search Class Completed!")
    //                 }
    //             });
    //         }
    //         return retval;
    //     }
    // }
    // // // 第三种，通过热加载dex的方式
    // var overloadCount = BaseDexClassLoader["$init"].overloads.length;
    // for (var i = 0; i < overloadCount; i++) {
    //     BaseDexClassLoader["$init"].overloads[i].implementation = function () {
    //         var retval = this["$init"].apply(this, arguments);
    //         findClassesInClassLoader(this, targetClass,targetMethod,trace);
    //         return retval;
    //     }
    // }
    // const Class = Java.use('java.lang.Class');
    // var hook = false;
    // Class.getResourceAsStream.implementation = function(name) {
    //     const originalResult = this.getResourceAsStream(name);
    //     console.log(`[*] Hooked getResourceAsStream called with name: ${name}`);
    //     if(name.indexOf("com/appsflyer/internal/b-")>0&& !hook){
    //         hook = true;
    //         enumerateClassLoaders(targetClass, targetMethod);
    //     }
    //     // 返回原始方法的结果
    //     return originalResult;
    // };
    // 对于读取内存的jar文件的精准定位
    const classLoaderClass = Java.use('java.lang.ClassLoader');
    classLoaderClass.loadClass.overload('java.lang.String').implementation = function (className) {
        const retval = this.loadClass(className);
        if (className === targetClass) {
            log(`[*] Loaded class: ${className}`);
            // 加载了目标类，hook 其方法
            enumerateClassLoaders(targetClass, targetMethod);
        }
        return retval;
    };
}
function enumerateClassLoaders(targetClass, targetMethod) {
    log('Begin enumerateClasses ...');
    Java.enumerateClassLoaders({
        onMatch: function (loader) {
            try {
                if (loader.findClass(targetClass)) {
                    log("Successfully found loader");
                    log("loader is : " + loader);
                    Java.classFactory.loader = loader;
                    log("Switch Classloader Successfully ! ");
                }
            }
            catch (error) {
                // console.log('enumerateClassLoaders error: ' + error + '\n')
            }
        },
        onComplete: function () {
            // log("EnumerateClassloader END")
        }
    });
    var targetClasses = new Array();
    Java.enumerateLoadedClasses({
        onMatch: function (clazz) {
            // console.log(clazz)
            if (clazz.toLowerCase().indexOf(targetClass.toLowerCase()) > -1) {
                // if (clazz.toLowerCase() == targetClass.toLowerCase()) {
                log('find targetClass class: ' + clazz);
                targetClasses.push(clazz);
                _trace(clazz, targetMethod);
            }
        },
        onComplete: function () {
            log("Search Class Completed!");
        }
    });
    var output = "On Total Tracing :" + String(targetClasses.length) + " classes :\r\n";
    targetClasses.forEach(function (target) {
        output = output.concat(target);
        output = output.concat("\r\n");
    });
    log(output);
}
export function trace(targetClass, targetMethod) {
    // findAllJavaClasses(targetClass,targetMethod,true);
    enumerateClassLoaders(targetClass, targetMethod);
}
✄
export declare function _trace(targetClass: any, method: any): void;
export declare function trace_change(target: any, method: any): void;

✄
{"version":3,"file":"trace_change.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/java/trace_change.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
import { log, stacktrace } from "../utils/log.js";
function extractPackageName(path) {
    var startIndex = path.lastIndexOf('/');
    var endIndex = path.indexOf('/', startIndex + 1);
    if (startIndex !== -1 && endIndex !== -1) {
        return path.substring(startIndex + 1, endIndex);
    }
    else {
        return 'com.lazada.android'; // 无法提取包名时返回空字符串或其他默认值
    }
}
function traceMethod(targetMethod, unparseMethod) {
    var delim = targetMethod.lastIndexOf(".");
    var targetClass = targetMethod.slice(0, delim);
    var targetMethod = targetMethod.slice(delim + 1, targetMethod.length);
    var hook = Java.use(targetClass);
    if (!hook[targetMethod]) {
        log("Class not found: " + targetClass);
        return;
    }
    var overloadCount = hook[targetMethod].overloads.length;
    for (var i = 0; i < overloadCount; i++) {
        hook[targetMethod].overloads[i].implementation = function () {
            var output = "";
            for (var j = 0; j < arguments.length; j++) {
                output = output.concat("arg[" + j + "]: " + arguments[j] + " => " + JSON.stringify(arguments[j]));
                output = output.concat("\n");
            }
            var retval = this[targetMethod].apply(this, arguments);
            // //返回值
            output = output.concat("\n retval: " + retval + " => " + JSON.stringify(retval));
            // 进入函数
            output = output.concat("*********entered " + unparseMethod + "********* \n");
            log("*********entered " + unparseMethod + "********* \n");
            output = output.concat("\n----------------------------------------\n");
            var stacktraceLog = stacktrace();
            if (targetMethod == "getDataDir" && stacktraceLog.indexOf("com.lazada.android") != -1) {
                var File = Java.use('java.io.File');
                var path = retval.getPath();
                if (path.indexOf('ratel') == -1) {
                    var replacedPath = path + '/app_ratel_env_mock/default_0/data/';
                    output = output.concat("replace path is => ", replacedPath, "\n");
                    var file = File.$new(replacedPath);
                    log(output);
                    return file;
                }
            }
            // var context= arguments[0];
            // var dir = context.getDir("SGLib",0);
            // output = output.concat("dir is => ",dir.getAbsolutePath(),"\n");
            //         // var cls = "com.appsflyer.internal.AFf1cSDK"
            //         // var obj = Java.use(cls)
            //         // var csl2 = 'com.appsflyer.internal.AFa1xSDK'
            //         // var obj2 = Java.use(csl2)
            //         // output = output.concat("value values " + bytes2hex(obj2._values.value) + '\n');
            //         // output = output.concat("value AFInAppEventType " + bytes2hex(obj2._AFInAppEventType.value) + '\n');
            //         // output = output.concat("value AFKeystoreWrapper "+obj2._AFKeystoreWrapper.value.charCodeAt(0)+'\n');
            //         // output = output.concat("value AFf1cSDK.AFInAppEventType " + bytes2hex(obj.AFInAppEventType.value) + '\n');
            //         // output = output.concat("value AFf1cSDK.values " + obj.values.value.charCodeAt(0) + '\n');
            //         // output = output.concat("value AFf1cSDK.AFKeystoreWrapper " + obj.AFKeystoreWrapper.value.charCodeAt(0) + '\n');
            //         // output = output.concat("value AFf1cSDK.valueOf " + obj.valueOf.value + '\n');
            //         // output = output.concat("value AFf1cSDK.AFInAppEventParameterName " + obj.AFInAppEventParameterName.value + '\n');
            //         // output = output.concat("value AFf1cSDK.AFLogger " + obj.AFLogger.value + '\n');
            //         // output = output.concat("value AFf1cSDK.afErrorLog " + obj.afErrorLog.value + '\n');
            //         // output = output.concat(arguments[-1]+'\n')
            output = output.concat("----------------------------------------\n");
            //离开函数
            output = output.concat("\n ********* exiting " + targetMethod + '*********\n');
            log(output);
            return retval;
        };
    }
}
export function _trace(targetClass, method) {
    var output = "Tracing Class: " + targetClass + "\n";
    var hook = Java.use(targetClass);
    var methods = hook.class.getDeclaredMethods();
    hook.$dispose();
    var methodsDict = {};
    methods.forEach(_method => {
        _method = _method.toString();
        var parsedMethod = _method.replace(targetClass + ".", "TOKEN").match(/\sTOKEN(.*)\(/)[1];
        if (method && method.toLowerCase() !== parsedMethod.toLowerCase())
            return;
        methodsDict[parsedMethod] = _method;
    });
    var Targets = methodsDict;
    //添加构造函数
    var constructors = hook.class.getDeclaredConstructors();
    if (constructors.length > 0) {
        //有时候hook构造函数会报错，看情况取消
        // methodsDict["$init"]='$init';
    }
    //对数组中所有的方法进行hook，
    for (var parsedMethod in methodsDict) {
        var unparseMethod = methodsDict[parsedMethod];
        traceMethod(targetClass + "." + parsedMethod, unparseMethod);
    }
}
export function trace_change(target, method) {
    Java.perform(function () {
        //有一种特殊的情况，需要use一下，才能hook到
        try {
            Java.use(target);
        }
        catch (error) {
            // console.log(error)
        }
        // log('\ntrace begin ... !')
        Java.enumerateClassLoaders({
            onMatch: function (loader) {
                try {
                    if (loader.findClass(target)) {
                        Java.classFactory.loader = loader;
                    }
                }
                catch (error) {
                    // console.log('enumerateClassLoaders error: ' + error + '\n')
                }
            },
            onComplete: function () {
            }
        });
        var targetClasses = new Array();
        Java.enumerateLoadedClasses({
            onMatch: function (clazz) {
                if (clazz.toLowerCase().indexOf(target.toLowerCase()) > -1) {
                    // if (clazz.toLowerCase() == target.toLowerCase()) {
                    targetClasses.push(clazz);
                    _trace(clazz, method);
                }
            },
            onComplete: function () {
            }
        });
    });
}
✄
interface HexdumpOptions {
    showTotal?: boolean;
    showAscii?: boolean;
    bytesPerLine?: number;
}
export declare function hexdumpAdvanced(buffer: any, length?: number, options?: HexdumpOptions): void;
export declare function hexdumpAsciiOnly(buffer: any, length?: number): string;
export {};

✄
{"version":3,"file":"BufferUtils.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/BufferUtils.ts"],"names":[],"mappings":"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"}
✄
// @ts-nocheck
// src/utils/buffer.ts
import { log } from "../utils/log.js";
export function hexdumpAdvanced(buffer, length = 500, options = {}) {
    const { showTotal = true, showAscii = true, bytesPerLine = 16 } = options;
    let output = '';
    if (showTotal) {
        output += `Total length: ${length} (0x${length.toString(16)})\n`;
    }
    // 判断buffer是否为空
    if (!buffer) {
        log('Buffer is null');
        return;
    }
    output += 'Offset    | 00 01 02 03 04 05 06 07  08 09 0A 0B 0C 0D 0E 0F';
    if (showAscii)
        output += ' | ASCII';
    output += '\n' + '-'.repeat(showAscii ? 75 : 58) + '\n';
    for (let i = 0; i < length; i += bytesPerLine) {
        output += `${i.toString(16).padStart(8, '0')}  | `;
        let hexPart = '';
        let asciiPart = '';
        for (let j = 0; j < bytesPerLine; j++) {
            if (i + j < length) {
                const byte = buffer.add(i + j).readU8();
                hexPart += `${byte.toString(16).padStart(2, '0')} `;
                if (showAscii) {
                    const char = (byte >= 32 && byte <= 126) ? String.fromCharCode(byte) : '.';
                    asciiPart += char;
                }
                if (j === 7)
                    hexPart += ' ';
            }
            else {
                hexPart += '   ';
                if (j === 7)
                    hexPart += ' ';
                if (showAscii)
                    asciiPart += ' ';
            }
        }
        log(output + hexPart + (showAscii ? `| ${asciiPart}` : ''));
        output = '';
    }
}
export function hexdumpAsciiOnly(buffer, length = 500) {
    try {
        let result = '';
        for (let i = 0; i < length; i++) {
            const byte = buffer.add(i).readU8();
            // 只获取可打印的 ASCII 字符
            if (byte >= 32 && byte <= 126) {
                result += String.fromCharCode(byte);
            }
        }
        // 输出结果
        log(result);
        return result;
    }
    catch (e) {
        return "";
    }
    // 如果你需要返回结果而不是直接打印
}
✄
export declare function all_so(system?: boolean): void;

✄
{"version":3,"file":"all_so.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/all_so.ts"],"names":[],"mappings":"AAAA,aAAa;AACb,uCAAuC;AAEvC,MAAM,UAAU,MAAM,CAAC,SAAkB,KAAK;IAC1C;QACI,OAAO,CAAC,gBAAgB,CAAC;YACrB,OAAO,EAAE,UAAU,MAAM;gBAErB,IAAI,MAAM,EAAE;oBACR,IAAI,CAAC,MAAM,CAAC,IAAI,CAAC,QAAQ,CAAC,WAAW,CAAC;wBAClC,OAAO,CAAC,GAAG,CAAC,eAAe,GAAG,MAAM,CAAC,IAAI,GAAG,KAAK,GAAG,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,KAAK,GAAG,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;iBACvI;qBAAM;oBACH,OAAO,CAAC,GAAG,CAAC,eAAe,GAAG,MAAM,CAAC,IAAI,GAAG,KAAK,GAAG,gBAAgB,GAAG,MAAM,CAAC,IAAI,CAAC,QAAQ,EAAE,GAAG,KAAK,GAAG,QAAQ,GAAG,MAAM,CAAC,IAAI,CAAC,CAAC;iBACnI;YACL,CAAC;YACD,UAAU,EAAE;YACZ,CAAC;SACJ,CAAC,CAAC;KACN;AACL,CAAC"}
✄
//@ts-nocheck
// import {log} from "../utils/log.js";
export function all_so(system = false) {
    {
        Process.enumerateModules({
            onMatch: function (module) {
                if (system) {
                    if (!module.path.includes('/data/app'))
                        console.log('Module name: ' + module.name + " - " + "Base Address: " + module.base.toString() + " - " + "path: " + module.path);
                }
                else {
                    console.log('Module name: ' + module.name + " - " + "Base Address: " + module.base.toString() + " - " + "path: " + module.path);
                }
            },
            onComplete: function () {
            }
        });
    }
}
✄
export declare function hook_func(so_name: any, addr: any): void;
export declare function _hook_func(so_name: any, func_name: any): void;

✄
{"version":3,"file":"hook_func.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/hook_func.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
export function hook_func(so_name, addr) {
    var android_dlopen_ext = Module.findExportByName(null, "android_dlopen_ext");
    if (android_dlopen_ext != null) {
        Interceptor.attach(android_dlopen_ext, {
            onEnter: function (args) {
                var soName = args[0].readCString();
                console.log("soName: " + soName);
                if (soName.indexOf(so_name) != -1) {
                    this.hook = true;
                }
            },
            onLeave: function (retval) {
                if (this.hook)
                    _hook_func(so_name, addr);
            }
        });
    }
}
export function _hook_func(so_name, func_name) {
    console.log('find so');
    var so_addr = Module.findBaseAddress(so_name);
    console.log('so_addr: ' + so_addr);
    var func = Module.findExportByName(so_name, func_name);
    console.log("[+] Hooking function: " + func);
    Java.perform(function () {
        Interceptor.attach(func, {
            onEnter: function (args) {
                console.log('enter');
                // console.log(hexdump(this.context.PC))
                // console.log("args[0] Intercepted: " + hexdump(args[0]))
                // console.log("args[0] Intercepted: " + readStdString(args[1]))
                // console.log("args[2] Intercepted: " + args[2])
                // console.log("args[3] Intercepted: " + hexdump(args[3]))
                // console.log("args[4] Intercepted: " + hexdump(args[4]))
                // console.log("args[5] Intercepted: " + hexdump(args[5]))
                // console.log("args[6] Intercepted: " + hexdump(args[6]))
                // console.log("args[7] Intercepted: " + hexdump(args[7]))
                // console.log("args[8] Intercepted: " + hexdump(args[8]))
                // console.log("args[9] Intercepted: " + hexdump(args[9]))
                // console.log("args[10] Intercepted: " + hexdump(args[10]))
                // console.log("args[11] Intercepted: " + hexdump(args[11]))
                // console.log("args[12] Intercepted: " + hexdump(args[12]))
                console.log('*********************\nCCCryptorCreate called from:\n*********************' + Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n') + '\n');
            },
            onLeave: function (retval) {
                console.log("[+] Returned: " + hexdump(retval));
                // console.log("retval is :", retval)
                return retval;
            }
        });
    });
}
function readStdString(str) {
    // console.log(Memory.readCString(str));
    // console.log(Memory.readUtf8String(str));
    return Memory.readUtf8String(str);
}
function print_dump(addr, size) {
    //console(Memory.methods());
    var buf = Memory.readByteArray(addr, size);
    console.log("[function] send[*] " + addr.toString() + "  " + "length: " + size.toString() + "\n[data]");
    console.log(hexdump(buf, {
        offset: 0,
        length: size,
        header: false,
        ansi: false
    }));
    console.log("");
}
✄
export declare function hook_str(target_str: any): void;

✄
{"version":3,"file":"hook_str.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/hook_str.ts"],"names":[],"mappings":"AAAA,aAAa;AACb,OAAO,EAAE,GAAG,EAAC,aAAa,EAAiB,MAAM,iBAAiB,CAAC;AAEnE,MAAM,UAAU,QAAQ,CAAC,UAAU;IAC3B,GAAG,CAAC,0BAA0B,CAAC,CAAC;IAEhC,eAAe;IACf,MAAM,WAAW,GAAG;QAChB,uDAAuD;QACvD,uDAAuD;QAEvD,sBAAsB;QACtB,YAAY;QACZ,aAAa;QACb,+BAA+B;QAC/B,YAAY;QAEZ,QAAQ;KACX,CAAC;IAEF,SAAS;IACT,WAAW,CAAC,OAAO,CAAC,QAAQ,CAAC,EAAE;QAC3B,MAAM,OAAO,GAAG,MAAM,CAAC,gBAAgB,CAAC,IAAI,EAAE,QAAQ,CAAC,CAAC;QACxD,IAAI,OAAO,EAAE;YACT,GAAG,CAAC,WAAW,QAAQ,MAAM,OAAO,EAAE,CAAC,CAAC;YAExC,WAAW,CAAC,MAAM,CAAC,OAAO,EAAE;gBACxB,OAAO,EAAE,UAAS,IAAI;oBAClB,IAAI,CAAC,QAAQ,GAAG,QAAQ,CAAC;oBAEzB,cAAc;oBACd,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,CAAC,EAAE,CAAC,EAAE,EAAE;wBACxB,IAAI,CAAC,IAAI,CAAC,CAAC,CAAC;4BAAE,SAAS;wBAEvB,IAAI;4BACA,cAAc;4BACd,MAAM,GAAG,GAAG,MAAM,CAAC,cAAc,CAAC,IAAI,CAAC,CAAC,CAAC,CAAC,CAAC;4BAC3C,IAAI,GAAG,IAAI,GAAG,IAAI,IAAI,IAAI,GAAG,IAAI,EAAE,EAAC;gCAChC,wCAAwC;gCACxC,yCAAyC;gCACrC,IAAI,GAAG,IAAI,GAAG,CAAC,QAAQ,CAAC,UAAU,CAAC,EAAE;oCACrC,GAAG,CAAC,IAAI,QAAQ,QAAQ,CAAC,KAAK,GAAG,EAAE,CAAC,CAAC;oCACrC,GAAG,CAAC,aAAa,CAAC,IAAI,CAAC,OAAO,CAAC,CAAC,CAAC;iCACpC;6BACJ;yBACJ;wBAAC,OAAO,CAAC,EAAE;4BACR,kBAAkB;yBACrB;qBACJ;gBACL,CAAC;aACJ,CAAC,CAAC;SACN;IACL,CAAC,CAAC,CAAC;AACP,CAAC"}
✄
//@ts-nocheck
import { log, stacktrace_so } from "../utils/log.js";
export function hook_str(target_str) {
    log('Hooking string functions');
    // 常见的字符串处理函数列表
    const stringFuncs = [
        // "strlen", "strcmp", "strncmp", "strcpy", "strncpy", 
        // "strcat", "strncat", "strchr", "strrchr", "strstr", 
        // "strcpy","strncpy",
        // "strcat",
        // "strncat",
        // "strchr","strrchr","strstr",
        // "memcmp",
        "memcpy",
    ];
    // 监控这些函数
    stringFuncs.forEach(funcName => {
        const funcPtr = Module.findExportByName(null, funcName);
        if (funcPtr) {
            log(`Hooking ${funcName} @ ${funcPtr}`);
            Interceptor.attach(funcPtr, {
                onEnter: function (args) {
                    this.funcName = funcName;
                    // 检查第一个和第二个参数
                    for (let i = 0; i < 2; i++) {
                        if (!args[i])
                            continue;
                        try {
                            // 尝试读取参数作为字符串
                            const str = Memory.readUtf8String(args[i]);
                            if (str && str != null && str != '') {
                                // log(`[${funcName}] arg${i}: ${str}`);
                                // if (str && str.includes(target_str)) {
                                if (str && str.includes("b59feaf6")) {
                                    log(`[${funcName}] arg${i}: ${str}`);
                                    log(stacktrace_so(this.context));
                                }
                            }
                        }
                        catch (e) {
                            // 可能不是有效的字符串，继续执行
                        }
                    }
                }
            });
        }
    });
}
✄
export declare function init_array(): void;

✄
{"version":3,"file":"init_array.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/init_array.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
export function init_array() {
    if (Process.pointerSize == 4) {
        var linker = Process.findModuleByName("linker");
    }
    else {
        var linker = Process.findModuleByName("linker64");
    }
    var addr_call_function = null;
    var addr_g_ld_debug_verbosity = null;
    var addr_async_safe_format_log = null;
    if (linker) {
        //console.log("found linker");
        var symbols = linker.enumerateSymbols();
        for (var i = 0; i < symbols.length; i++) {
            var name = symbols[i].name;
            if (name.indexOf("call_function") >= 0) {
                addr_call_function = symbols[i].address;
                // console.log("call_function",JSON.stringify(symbols[i]));
            }
            else if (name.indexOf("g_ld_debug_verbosity") >= 0) {
                addr_g_ld_debug_verbosity = symbols[i].address;
                ptr(addr_g_ld_debug_verbosity).writeInt(2);
            }
            else if (name.indexOf("async_safe_format_log") >= 0 && name.indexOf('va_list') < 0) {
                // console.log("async_safe_format_log",JSON.stringify(symbols[i]));
                addr_async_safe_format_log = symbols[i].address;
            }
        }
    }
    if (addr_async_safe_format_log) {
        Interceptor.attach(addr_async_safe_format_log, {
            onEnter: function (args) {
                this.log_level = args[0];
                this.tag = ptr(args[1]).readCString();
                this.fmt = ptr(args[2]).readCString();
                if (this.fmt.indexOf("c-tor") >= 0 && this.fmt.indexOf('Done') < 0) {
                    this.function_type = ptr(args[3]).readCString(), // func_type
                        this.so_path = ptr(args[5]).readCString();
                    var strs = new Array(); //定义一数组
                    strs = this.so_path.split("/"); //字符分割
                    this.so_name = strs.pop();
                    this.func_offset = ptr(args[4]).sub(Module.findBaseAddress(this.so_name));
                    console.log("func_type:", this.function_type, '\nso_name:', this.so_name, '\nso_path:', this.so_path, '\nfunc_offset:', this.func_offset);
                    // hook代码在这加
                }
            },
            onLeave: function (retval) {
            }
        });
    }
}
// setTimeout(init_array)
✄
export declare function inline_hook(so_name: any, addr: any): void;
export declare function _inline_hook(so_name: any, addr: any): void;

✄
{"version":3,"file":"inlinehook.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/inlinehook.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
export function inline_hook(so_name, addr) {
    var android_dlopen_ext = Module.findExportByName(null, "android_dlopen_ext");
    if (android_dlopen_ext != null) {
        Interceptor.attach(android_dlopen_ext, {
            onEnter: function (args) {
                var soName = args[0].readCString();
                if (soName.indexOf(so_name) != -1) {
                    this.hook = true;
                }
            },
            onLeave: function (retval) {
                if (this.hook)
                    _inline_hook(so_name, addr);
            }
        });
    }
}
export function _inline_hook(so_name, addr) {
    console.log('find so');
    var so_addr = Module.findBaseAddress(so_name);
    console.log('so_addr: ' + so_addr);
    var func = so_addr.add(addr);
    console.log("[+] Hooking function: " + func);
    Java.perform(function () {
        Interceptor.attach(func, {
            onEnter: function (args) {
                console.log('enter');
                // console.log(hexdump(this.context.PC))
                // console.log("args[0] Intercepted: " + hexdump(args[0]))
                // console.log("args[0] Intercepted: " + readStdString(args[1]))
                // console.log("args[2] Intercepted: " + args[2])
                // console.log("args[3] Intercepted: " + hexdump(args[3]))
                // console.log("args[4] Intercepted: " + hexdump(args[4]))
                // console.log("args[5] Intercepted: " + hexdump(args[5]))
                // console.log("args[6] Intercepted: " + hexdump(args[6]))
                // console.log("args[7] Intercepted: " + hexdump(args[7]))
                // console.log("args[8] Intercepted: " + hexdump(args[8]))
                // console.log("args[9] Intercepted: " + hexdump(args[9]))
                // console.log("args[10] Intercepted: " + hexdump(args[10]))
                // console.log("args[11] Intercepted: " + hexdump(args[11]))
                // console.log("args[12] Intercepted: " + hexdump(args[12]))
                console.log('*********************\nCCCryptorCreate called from:\n*********************' + Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n') + '\n');
            },
            onLeave: function (retval) {
                console.log("[+] Returned: " + hexdump(retval));
                // console.log("retval is :", retval)
                return retval;
            }
        });
    });
}
function readStdString(str) {
    // console.log(Memory.readCString(str));
    // console.log(Memory.readUtf8String(str));
    return Memory.readUtf8String(str);
}
function print_dump(addr, size) {
    //console(Memory.methods());
    var buf = Memory.readByteArray(addr, size);
    console.log("[function] send[*] " + addr.toString() + "  " + "length: " + size.toString() + "\n[data]");
    console.log(hexdump(buf, {
        offset: 0,
        length: size,
        header: false,
        ansi: false
    }));
    console.log("");
}
✄
export {};

✄
{"version":3,"file":"scan.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/scan.ts"],"names":[],"mappings":"AAAA,aAAa;AACb,0FAA0F;AAC1F,2BAA2B;;AAE3B,uEAAuE;AAEvE,+FAA+F;AAC/F,4EAA4E;AAC5E,oLAAoL;AACpL,aAAa;AACb,qCAAqC;AACrC,qBAAqB;AACrB,sCAAsC;AACtC,aAAa;AACb,oCAAoC;AACpC,qCAAqC;AACrC,YAAY;AACZ,UAAU;AACV,IAAI;AAEJ,iEAAiE;AACjE,iFAAiF"}
✄
//@ts-nocheck
// var _m = Process.enumerateModules();// enumerate loaded modules and take the first on_m
// for (var module of _m) {
export {};
//     var pattern = 'C7 C7 65 47 65 74 44 65  78 44 61 74 61 00 35 30'
//     Memory.scan(/*NativePointer*/ module.base, /*number*/ module.size, /*string*/ pattern, {
//         onMatch: function (address, size) {// called when pattern matches
//             console.log("Memory.scan() found at " + address +'Module name: ' + module.name + " - " + "Base Address: " + module.base.toString() + " - " + "path: " + module.path);
//         },
//         onError: function(reason){
//             //搜索失败
//             // console.log('搜索失败');
//         },
//         onComplete: function () {
//             // console.log("搜索完毕")
//         }
//     });
// }
//     // var results = Memory.scanSync(m.base, m.size, pattern);
//     // console.log("Memory.scanSync() result = \n" + JSON.stringify(results));
✄
export declare function sktrace(so_name: any): void;

✄
{"version":3,"file":"sktrace.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/sktrace/sktrace.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
import { hook_dlopen } from "../utils.js";
const arm64CM = new CModule(`
#include <gum/gumstalker.h>
#include <stdio.h>
#include <string.h>
#include <stdlib.h>

extern void on_message(const gchar *message);
static void log(const gchar *format, ...);
static void on_arm64_before(GumCpuContext *cpu_context, gpointer user_data);
static void on_arm64_after(GumCpuContext *cpu_context, gpointer user_data);

void hello() {
    on_message("Hello form CModule");
}

gpointer shared_mem[] = {0, 0};

gpointer 
get_shared_mem() 
{
    return shared_mem;
}


static void
log(const gchar *format, ...)
{
    gchar *message;
    va_list args;

    va_start(args, format);
    message = g_strdup_vprintf(format, args);
    va_end(args);

    on_message(message);
    g_free(message);
}


void transform(GumStalkerIterator *iterator,
               GumStalkerOutput *output,
               gpointer user_data)
{
    cs_insn *insn;

    gpointer base = *(gpointer*)user_data;
    gpointer end = *(gpointer*)(user_data + sizeof(gpointer));
    
    while (gum_stalker_iterator_next(iterator, &insn))
    {
        gboolean in_target = (gpointer)insn->address >= base && (gpointer)insn->address < end;
        if(in_target)
        {
            log("%p\t%s\t%s", (gpointer)insn->address, insn->mnemonic, insn->op_str);
            gum_stalker_iterator_put_callout(iterator, on_arm64_before, (gpointer) insn->address, NULL);
        }
        gum_stalker_iterator_keep(iterator);
        if(in_target) 
        {
            gum_stalker_iterator_put_callout(iterator, on_arm64_after, (gpointer) insn->address, NULL);
        }
    }
}


const gchar * cpu_format = "
    0x%x\t0x%x\t0x%x\t0x%x\t0x%x
    \t0x%x\t0x%x\t0x%x\t0x%x\t0x%x
    \t0x%x\t0x%x\t0x%x\t0x%x\t0x%x
    \t0x%x\t0x%x\t0x%x\t0x%x\t0x%x
    \t0x%x\t0x%x\t0x%x\t0x%x\t0x%x
    \t0x%x\t0x%x\t0x%x\t0x%x\t0x%x
    \t0x%x\t0x%x\t0x%x
    ";

static void
on_arm64_before(GumCpuContext *cpu_context,
        gpointer user_data)
{

}

static void
on_arm64_after(GumCpuContext *cpu_context,
        gpointer user_data)
{

}

`, {
    on_message: new NativeCallback(messagePtr => {
        const message = messagePtr.readUtf8String();
        console.log(message);
        // send(message)
    }, 'void', ['pointer']),
});
const userData = Memory.alloc(Process.pageSize);
function stalkerTraceRangeC(tid, base, size) {
    // const hello = new NativeFunction(cm.hello, 'void', []);
    // hello();
    userData.writePointer(base);
    const pointerSize = Process.pointerSize;
    userData.add(pointerSize).writePointer(base.add(size));
    Stalker.follow(tid, {
        transform: arm64CM.transform,
        // onEvent: cm.process,
        data: userData /* user_data */
    });
}
function stalkerTraceRange(tid, base, size) {
    Stalker.follow(tid, {
        transform: (iterator) => {
            const instruction = iterator.next();
            const startAddress = instruction.address;
            const isModuleCode = startAddress.compare(base) >= 0 &&
                startAddress.compare(base.add(size)) < 0;
            // const isModuleCode = true;
            do {
                iterator.keep();
                if (isModuleCode) {
                    send({
                        type: 'inst',
                        tid: tid,
                        block: startAddress,
                        val: JSON.stringify(instruction)
                    });
                    iterator.putCallout((context) => {
                        send({
                            type: 'ctx',
                            tid: tid,
                            val: JSON.stringify(context)
                        });
                    });
                }
            } while (iterator.next() !== null);
        }
    });
}
function traceAddr(addr) {
    let moduleMap = new ModuleMap();
    let targetModule = moduleMap.find(addr);
    console.log(JSON.stringify(targetModule));
    let exports = targetModule.enumerateExports();
    let symbols = targetModule.enumerateSymbols();
    // send({
    //     type: "module", 
    //     targetModule
    // })
    // send({
    //     type: "sym",
    // })
    Interceptor.attach(addr, {
        onEnter: function (args) {
            this.tid = Process.getCurrentThreadId();
            // stalkerTraceRangeC(this.tid, targetModule.base, targetModule.size)
            stalkerTraceRange(this.tid, targetModule.base, targetModule.size);
        },
        onLeave: function (ret) {
            Stalker.unfollow(this.tid);
            Stalker.garbageCollect();
            send({
                type: "fin",
                tid: this.tid
            });
        }
    });
}
function traceSymbol(symbol) {
}
/**
 * from jnitrace-egine
 */
function watcherLib(libname, callback) {
    const dlopenRef = Module.findExportByName(null, "dlopen");
    const dlsymRef = Module.findExportByName(null, "dlsym");
    const dlcloseRef = Module.findExportByName(null, "dlclose");
    if (dlopenRef !== null && dlsymRef !== null && dlcloseRef !== null) {
        const dlopen = new NativeFunction(dlopenRef, "pointer", ["pointer", "int"]);
        Interceptor.replace(dlopen, new NativeCallback((filename, mode) => {
            const path = filename.readCString();
            const retval = dlopen(filename, mode);
            if (path !== null) {
                if (checkLibrary(path)) {
                    // eslint-disable-next-line @typescript-eslint/no-base-to-string
                    trackedLibs.set(retval.toString(), true);
                }
                else {
                    // eslint-disable-next-line @typescript-eslint/no-base-to-string
                    libBlacklist.set(retval.toString(), true);
                }
            }
            return retval;
        }, "pointer", ["pointer", "int"]));
    }
}
function _sktrace(so_name) {
    const targetModule = Module.getBaseAddress(so_name);
    console.log("targetModule:", targetModule);
    // if("symbol" in payload) {
    //     targetAddress = targetModule.findExportByName(payload.symbol);
    // } else if("offset" in payload) {
    //     targetAddress = targetModule.base.add(ptr(payload.offset));
    // }
    var targetAddress = targetModule.add(ptr(0x1208));
    traceAddr(targetAddress);
}
export function sktrace(so_name) {
    hook_dlopen(so_name, _sktrace, so_name);
}
✄
export declare function so_info(so_name: any): void;

✄
{"version":3,"file":"so_info.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/so_info.ts"],"names":[],"mappings":"AAAA,aAAa;AAEb,MAAM,UAAU,OAAO,CAAC,OAAO;IAC3B,KAAK;IACL,IAAI,OAAO,GAAG,MAAM,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;IACnD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACrC,OAAO,CAAC,GAAG,CAAC,SAAS,GAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,GAAC,IAAI,CAAC,CAAA;KAC1E;IAED,KAAK;IACL,IAAI,OAAO,GAAG,MAAM,CAAC,oBAAoB,CAAC,OAAO,CAAC,CAAC;IACnD,KAAK,IAAI,CAAC,GAAG,CAAC,EAAE,CAAC,GAAG,OAAO,CAAC,MAAM,EAAE,CAAC,EAAE,EAAE;QACrC,OAAO,CAAC,GAAG,CAAC,QAAQ,GAAC,OAAO,CAAC,CAAC,CAAC,CAAC,IAAI,GAAG,IAAI,GAAG,OAAO,CAAC,CAAC,CAAC,CAAC,OAAO,GAAC,IAAI,CAAC,CAAC;KAC1E;AACL,CAAC"}
✄
//@ts-nocheck
export function so_info(so_name) {
    // 导入
    var imports = Module.enumerateImportsSync(so_name);
    for (var i = 0; i < imports.length; i++) {
        console.log('import:' + imports[i].name + ": " + imports[i].address + '\n');
    }
    // 导出
    var exports = Module.enumerateExportsSync(so_name);
    for (var i = 0; i < exports.length; i++) {
        console.log('export' + exports[i].name + ": " + exports[i].address + '\n');
    }
}
✄
export declare function so_method(so_name: string): void;

✄
{"version":3,"file":"so_method.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/so_method.ts"],"names":[],"mappings":"AACA,aAAa;AACb,OAAO,EAAE,GAAG,EAAE,MAAM,iBAAiB,CAAC;AACtC,OAAO,EAAC,WAAW,EAAC,MAAM,YAAY,CAAC;AAGvC,MAAM,UAAU,SAAS,CAAC,OAAc;IACpC,WAAW,CAAC,OAAO,EAAC;QAChB,IAAI,MAAM,GAAG,EAAE,CAAA;QACf,MAAM,aAAa,GAAG,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAA;QACtD,aAAa,CAAC,OAAO,CAAC,CAAC,OAAyB,EAAE,EAAE;YAChD,MAAM,IAAI,iBAAiB,OAAO,CAAC,IAAI,IAAI,CAAC;QAChD,CAAC,CAAC,CAAC;QAEH,MAAM,cAAc,GAAG,MAAM,CAAC,gBAAgB,CAAC,OAAO,CAAC,CAAA;QACvD,cAAc,CAAC,OAAO,CAAC,CAAC,OAAyB,EAAE,EAAE;YACjD,MAAM,IAAI,iBAAiB,OAAO,CAAC,IAAI,IAAI,CAAC;QAChD,CAAC,CAAC,CAAC;QAEH,MAAM,aAAa,GAAG,MAAM,CAAC,gBAAgB,CAAC,kBAAkB,CAAC,CAAA;QACjE,aAAa,CAAC,OAAO,CAAC,CAAC,OAAyB,EAAE,EAAE;YAChD,MAAM,IAAI,iBAAiB,OAAO,CAAC,IAAI,IAAI,CAAC;QAChD,CAAC,CAAC,CAAC;QACH,GAAG,CAAC,MAAM,CAAC,CAAA;IACf,CAAC,CAAC,CAAA;AACN,CAAC"}
✄
//@ts-nocheck
import { log } from "../utils/log.js";
import { hook_dlopen } from "./utils.js";
export function so_method(so_name) {
    hook_dlopen(so_name, function () {
        var output = '';
        const export_method = Module.enumerateExports(so_name);
        export_method.forEach((element) => {
            output += `export method:${element.name}\n`;
        });
        const symbols_method = Module.enumerateSymbols(so_name);
        symbols_method.forEach((element) => {
            output += `export method:${element.name}\n`;
        });
        const improt_method = Module.enumerateImports('libencryptlib.so');
        improt_method.forEach((element) => {
            output += `export method:${element.name}\n`;
        });
        log(output);
    });
}
✄
export declare function hookNativeSocket(): void;

✄
{"version":3,"file":"socket.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/socket.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
export function hookNativeSocket() {
    const tcpSocketFDs = new Map();
    const fSocketConnect = Module.getExportByName("libc.so", "connect");
    Interceptor.attach(fSocketConnect, {
        onEnter(args) {
            this.sockFd = args[0].toInt32();
        },
        onLeave(res) {
            const sockFd = this.sockFd;
            const sockType = Socket.type(sockFd);
            if (!(sockType === "tcp6" || sockType === "tcp"))
                return;
            const sockLocal = Socket.localAddress(sockFd);
            const tcpEpLocal = sockLocal && sockLocal.ip ? sockLocal : undefined;
            const sockRemote = Socket.peerAddress(sockFd);
            const tcpEpRemote = sockRemote && sockRemote.ip ? sockRemote : undefined;
            if (!tcpEpLocal)
                return;
            // ToDo: if socket FD already exists in the set, a faked 'close' message shall be sent first (currently handled by receiving logic)
            tcpSocketFDs.set(sockFd, tcpEpLocal);
            let msg = {
                socketFd: sockFd,
                pid: Process.id,
                threadId: this.threadId,
                socketEventType: "connect",
                type: "socketCall",
                result: res
            };
            if (tcpEpLocal) {
                msg.hostip = tcpEpLocal.ip;
                msg.port = tcpEpLocal.port;
            }
            if (tcpEpRemote) {
                msg.dstIp = tcpEpRemote.ip;
                msg.dstPort = tcpEpRemote.port;
            }
            //if (Java.available) {     // checks presence of Java runtime in process
            if (Java.vm !== null && Java.vm.tryGetEnv() !== null) {
                // checks if Thread is JVM attached (JNI env available)
                let java_lang_Exception = Java.use("java.lang.Exception");
                var exception = java_lang_Exception.$new();
                const trace = exception.getStackTrace();
                msg.stack = trace.map(traceEl => {
                    return {
                        class: traceEl.getClassName(),
                        file: traceEl.getFileName(),
                        line: traceEl.getLineNumber(),
                        method: traceEl.getMethodName(),
                        isNative: traceEl.isNativeMethod(),
                        str: traceEl.toString()
                    };
                });
            }
            //send(msg)
            console.log(JSON.stringify(msg, null, 4));
        }
    });
    const libcEx = Process.getModuleByName("libc.so").enumerateExports();
    const socketExports = libcEx.filter(expDetails => expDetails.type === "function" &&
        ["shutdown", "close"].some(serachStr => serachStr === expDetails.name));
    socketExports.forEach(exp => {
        Interceptor.attach(exp.address, {
            onEnter(args) {
                const sockFd = args[0].toInt32();
                if (!tcpSocketFDs.has(sockFd))
                    return;
                const sockType = Socket.type(sockFd);
                if (tcpSocketFDs.has(sockFd)) {
                    const tcpEP = tcpSocketFDs.get(sockFd);
                    const msg = {
                        socketFd: sockFd,
                        pid: Process.id,
                        threadId: this.threadId,
                        socketEventType: exp.name,
                        hostip: tcpEP.ip,
                        port: tcpEP.port,
                        type: "socketCall"
                    };
                    tcpSocketFDs.delete(sockFd);
                    //send(msg)
                    console.log(JSON.stringify(msg, null, 4));
                }
            }
        });
    });
}
✄
export declare function stalker(_so_name: any, addr: any): void;
export declare function native_trace(_so_name: any, addr: any, size: any): void;

✄
{"version":3,"file":"stalker.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/stalker.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
import { log } from "../utils/log.js";
import { hook_dlopen } from "./utils.js";
var so_name;
export function stalker(_so_name, addr) {
    so_name = _so_name;
    hook_dlopen(so_name, _stalker, addr);
}
export function native_trace(_so_name, addr, size) {
    so_name = _so_name;
    hook_dlopen(so_name, _trace, addr, size);
}
function stalkerTraceRange(tid, base, size) {
    Stalker.follow(tid, {
        transform: (iterator) => {
            const instruction = iterator.next();
            const startAddress = instruction.address;
            const isModuleCode = startAddress.compare(base) >= 0 &&
                startAddress.compare(base.add(size)) < 0;
            // const isModuleCode = true;
            //transform是每个block触发。这里每个block触发的时候遍历出所有指令。
            do {
                iterator.keep();
                if (isModuleCode) {
                    //这里可以看到数据如果是inst就是一个指令，我们就需要解析打印
                    //输出样本如下
                    //'payload': {'type': 'inst', 'tid': 19019, 'block': '0x74fd8d4ff4', 'val': '{"address":"0x74fd8d4ffc","next":"0x4","size":4,"mnemonic":"add","opStr":"sp, sp, #0x70","operands":[{"type":"reg","value":"sp"},{"type":"reg","value":"sp"},{"type":"imm","value":"112"}],"regsRead":[],"regsWritten":[],"groups":[]}'}}
                    //py解析打印格式"add sp, sp, #0x70  //sp=112"        这里的处理应该还要更复杂。暂时先简单处理
                    log(instruction);
                    //这里是打印所有寄存器
                    //输出样本如下
                    //{'type': 'ctx', 'tid': 19019, 'val': '{"pc":"0x74fd8d4fe8","sp":"0x7fc28609d0","x0":"0x0","x1":"0x7fc2860908","x2":"0x0","x3":"0x756aec1349","x4":"0x7fc28608f0","x5":"0x14059dbe","x6":"0x7266206f6c6c6548","x7":"0x2b2b43206d6f7266","x8":"0x0","x9":"0x65af2e18847fd289","x10":"0x1","x11":"0x7fc2860a20","x12":"0xe","x13":"0x7fc2860a20","x14":"0xffffff0000000000","x15":"0x756aeed1b5","x16":"0x74fd8fadc8","x17":"0x74fd8d50d8","x18":"0x75f0bda000","x19":"0x75f02f9c00","x20":"0x756af59490","x21":"0x75f02f9c00","x22":"0x7fc2860c90","x23":"0x74ffcee337","x24":"0x4","x25":"0x75f04b4020","x26":"0x75f02f9cb0","x27":"0x1","x28":"0x756b3f2000","fp":"0x7fc2860a30","lr":"0x74fd8d4fdc"}'}}
                    //这里是寄存器变化时调用
                    iterator.putCallout((context) => {
                        log(JSON.stringify(context));
                    });
                }
            } while (iterator.next() !== null);
        }
    });
}
function _trace(addr, size) {
    var size = size || 0x1000;
    var base_addr = Module.getBaseAddress(so_name);
    console.log("base_addr:", base_addr);
    var func = base_addr.add(addr);
    console.log("func:", func);
    Interceptor.attach(func, {
        onEnter: function (args) {
            this.tid = Process.getCurrentThreadId();
            stalkerTraceRange(this.tid, func, size);
        }, onLeave(retval) {
            Stalker.unfollow(this.tid);
        }
    });
}
function _stalker(addr) {
    var base_addr = Module.getBaseAddress(so_name);
    console.log("base_addr:", base_addr);
    var func = base_addr.add(addr);
    console.log("func:", func);
    Interceptor.attach(func, {
        onEnter: function (args) {
            this.tid = Process.getCurrentThreadId();
            // console.log("enter func tid:",this.tid);
            Stalker.follow(this.tid, {
                events: {
                    call: true,
                    // Other events:
                    ret: false,
                    exec: false,
                    //                   a lot of data
                    block: false,
                    compile: false // block compiled: useful for coverage
                },
                onCallSummary: function (summary) {
                    for (var iter in summary) {
                        try {
                            var module = Process.getModuleByAddress(ptr(iter));
                            if (module.name.indexOf(so_name) != -1) {
                                console.log("onCallSummary", iter, ptr(iter).sub(module.base));
                            }
                        }
                        catch (err) {
                        }
                    }
                },
                onReceive: function (events) {
                    console.log("enter onReceive");
                    var eventsData = Stalker.parse(events, {
                        annotate: true,
                        stringify: true
                    });
                    for (var idx in eventsData) {
                        var dataSp = eventsData[idx];
                        var addr1 = dataSp[1];
                        var addr2 = dataSp[2];
                        try {
                            var module1 = Process.getModuleByAddress(ptr(addr1));
                            if (module1.name.indexOf(so_name) != -1) {
                                var module2 = Process.getModuleByAddress(ptr(addr2));
                                // onReceive + call + so名字 + 调用的地址 + 被调用的地址
                                // 只有被调用函数地址是原so时，才可以减去基地址
                                if (module2.name.indexOf(so_name) != -1) {
                                    console.log("onReceive:", dataSp[0] + ",调用的so:", module1.name, ",调用函数地址:", ptr(addr1 - base_addr), ",被调用的so:", module2.name, ",被调用的函数地址:", ptr(addr2 - base_addr));
                                }
                                else {
                                    console.log("onReceive:", dataSp[0] + ",调用的so:", module1.name, ",调用函数地址:", ptr(addr1 - base_addr), ",被调用的so:", module2.name, ",被调用的函数地址:", base_addr);
                                }
                            }
                        }
                        catch (err) {
                            console.log("onReceive error", dataSp[0], dataSp[1], dataSp[2]);
                        }
                    }
                },
                transform: function (iterator) {
                    var instruction = iterator.next();
                    const startAddress = instruction.address;
                    // 从ida里面 找到 Java_com_baidu_searchbox_NativeBds_dae1 函数的 代码 在 0xE84 和 0x126C 之间
                    // var isModule = startAddress.compare(base_addr.add(addr)) >= 0 && startAddress.compare(base_addr.add(0x126C)) < 0;
                    var isModule = startAddress.compare(base_addr.add(addr)) >= 0;
                    do {
                        if (isModule) {
                            console.log(instruction.address.sub(base_addr) + "\t:\t" + instruction);
                            if (instruction.address.sub(base_addr) == 0x122c) {
                                iterator.putCallout((context) => {
                                    // var string = Memory.readCString(context["sp"]);
                                    // console.log("####  key = " + string)
                                    console.log("####  key = " + Memory.readUInt(context.w0));
                                });
                            }
                        }
                        iterator.keep();
                    } while ((instruction = iterator.next()) !== null);
                },
            });
        }, onLeave(retval) {
            Stalker.unfollow(this.tid);
        }
    });
}
✄
export declare function hook_dlopen(so_name?: null, hook_func?: null, so_addr?: null): void;
/**
 * 监控字符串内容的简单函数
 * @param {string} so_name - 目标so文件名
*/
export declare function monitorStrings(so_name: any): void;
export declare function nativeHookFunction(onEnterCallback: any, onLeaveCallback: any, so_name: any, so_addr: any): void;

✄
{"version":3,"file":"utils.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/so/utils.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
import { log, stacktrace_so } from "../utils/log.js";
export function hook_dlopen(so_name = null, hook_func = null, so_addr = null) {
    log('hook_dlopen');
    // Hook android_dlopen_ext
    var android_dlopen_ext = Module.findExportByName(null, "android_dlopen_ext");
    if (android_dlopen_ext != null) {
        Interceptor.attach(android_dlopen_ext, {
            onEnter: function (args) {
                var soName = args[0].readCString();
                log('soName:' + soName);
                if (so_name && soName.indexOf(so_name) != -1) {
                    log('find so in android_dlopen_ext');
                    this.hook = true;
                }
            },
            onLeave: function (retval) {
                if (this.hook && hook_func) {
                    hook_func(so_addr); // 传入 so_addr 参数
                }
            }
        });
    }
    // Hook dlopen
    var dlopen = Module.findExportByName(null, "dlopen");
    if (dlopen != null) {
        Interceptor.attach(dlopen, {
            onEnter: function (args) {
                var soName = args[0].readCString();
                log('soName:' + soName);
                if (so_name && soName.indexOf(so_name) != -1) {
                    log('find so in dlopen');
                    this.hook = true;
                }
            },
            onLeave: function (retval) {
                if (this.hook && hook_func) {
                    hook_func(so_addr); // 传入 so_addr 参数
                }
            }
        });
    }
}
/**
 * 监控字符串内容的简单函数
 * @param {string} so_name - 目标so文件名
*/
export function monitorStrings(so_name) {
    // 基础字符串操作函数
    const functions = [
        'strcpy',
        // 'strcat',
        // 'sprintf',
        // 'snprintf',
        // 'memcpy',
        // 'strncpy'
    ];
    for (const funcName of functions) {
        const address = Module.findExportByName(null, funcName);
        if (!address)
            continue;
        Interceptor.attach(address, {
            onEnter(args) {
                try {
                    var stacktrace = stacktrace_so();
                    if (!stacktrace.includes(so_name))
                        return;
                    switch (funcName) {
                        case 'strcpy':
                        case 'strcat':
                        case 'strncpy': {
                            const sourceStr = Memory.readUtf8String(args[1]);
                            log(`[${funcName}] 字符串内容: ${sourceStr}`);
                            break;
                        }
                        case 'sprintf':
                        case 'snprintf': {
                            const formatStr = Memory.readUtf8String(args[1]);
                            log(`[${funcName}] 格式字符串: ${formatStr}`);
                            break;
                        }
                        case 'memcpy': {
                            try {
                                const size = args[2].toInt32();
                                const content = Memory.readUtf8String(args[1], size);
                                if (content) {
                                    log(`[${funcName}] 复制内容: ${content}`);
                                }
                            }
                            catch (e) { }
                            break;
                        }
                    }
                }
                catch (e) {
                    log(`[${funcName}] 读取失败: ${e}`);
                }
            },
            onLeave(retval) {
                var stacktrace = stacktrace_so();
                if (!stacktrace.includes(so_name))
                    return;
                // 检查结果字符串
                if (this.funcName === 'strcpy' || this.funcName === 'sprintf') {
                    try {
                        const result = Memory.readUtf8String(this.args[0]);
                        log(`[${this.funcName}_result] 结果: ${result}`);
                    }
                    catch (e) { }
                }
            }
        });
        log(`[*] 已hook ${funcName}`);
    }
}
// 比较通用的hook地址并且打印5个参数。如果参数是地址就打印下内存信息
// 增加两个回调函数参数：onEnterCallback和onLeaveCallback
// 增加so_name参数
export function nativeHookFunction(onEnterCallback, onLeaveCallback, so_name, so_addr) {
    // 在函数开头调用hook_dlopen
    hook_dlopen(so_name, function (dlopen_addr) {
        try {
            var base_addr = Module.getBaseAddress(so_name);
            var hook_addr = base_addr.add(so_addr);
            log("hook_addr:" + hook_addr);
            // 添加一个简单的测试 hook 来确认函数是否正常返回
            Interceptor.attach(hook_addr, {
                onEnter: function (args) {
                    try {
                        this.tid = Process.getCurrentThreadId();
                        // 使用printRegisters函数打印寄存器
                        // log("this.context:"+JSON.stringify(this.context, null, 4));
                        // log("x0:"+hexdump(this.context.x0));
                        // log("x1:"+hexdump(this.context.x1));
                        // log("x2:"+hexdump(this.context.x2,{length:5000}));
                        // log("x3:"+hexdump(this.context.x3));
                        // log("x4:"+hexdump(this.context.x4));
                        // log("x8:"+hexdump(this.context.x8));
                        // log("x16:"+hexdump(this.context.x16));
                        // log("x17:"+hexdump(this.context.x17));
                        // log("x18:"+hexdump(this.context.x18));
                        // log("x19:"+hexdump(this.context.x19));
                        // log("x20:"+hexdump(this.context.x20));
                        // log("x21:"+hexdump(this.context.x21));
                        // log("x22:"+hexdump(this.context.x22));
                        // log("x25:"+hexdump(this.context.x25));
                        // log("x28:"+hexdump(this.context.x28));
                        // printRegisters(this.context, null, null);
                        // 如果提供了onEnter回调函数，则调用它
                        // 传递args、this.context和base_addr作为参数
                        if (typeof onEnterCallback === 'function') {
                            onEnterCallback(args, this.context, null, base_addr, hook_addr, this.tid);
                        }
                        // 记录调用栈信息（可选，取消注释以启用）
                        // log("Call stack:\n" + Thread.backtrace(this.context, Backtracer.ACCURATE)
                        //     .map(DebugSymbol.fromAddress).join("\n"));
                    }
                    catch (e) {
                        log("Error in onEnter: " + e.message);
                    }
                },
                onLeave: function (retval) {
                    try {
                        log(`[${this.tid}] - Leave`);
                        Stalker.unfollow(this.tid);
                        if (retval) {
                            log("Return value: " + retval.toString());
                        }
                        // 如果提供了onLeave回调函数，则调用它
                        // 传递retval、this.context和base_addr作为参数
                        if (typeof onLeaveCallback === 'function') {
                            onLeaveCallback(this, retval, this.context, null, base_addr, hook_addr);
                        }
                    }
                    catch (e) {
                        log("Error in onLeave: " + e.message);
                    }
                }
            });
            log("Test hook installed");
        }
        catch (e) {
            log("Error in nativeHookFunction:", e.message);
        }
    }, so_addr);
}
✄
export declare function antiFrida(): void;

✄
{"version":3,"file":"anti_frida.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/utils/anti_frida.ts"],"names":[],"mappings":"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"}
✄
//@ts-nocheck
function anti_exit() {
    const exit_ptr = Module.findExportByName(null, 'exit');
    console.log('anti_exit', "exit_ptr : " + exit_ptr);
    if (null == exit_ptr) {
        return;
    }
    Interceptor.replace(exit_ptr, new NativeCallback(function (code) {
        if (null == this) {
            return 0;
        }
        var lr = getLR(this.context);
        console.log('exit debug', 'entry, lr: ' + lr);
        return 0;
    }, 'int', ['int', 'int']));
}
function anti_kill() {
    const kill_ptr = Module.findExportByName(null, 'kill');
    console.log('anti_kill', "kill_ptr : " + kill_ptr);
    if (null == kill_ptr) {
        return;
    }
    Interceptor.replace(kill_ptr, new NativeCallback(function (ptid, code) {
        if (null == this) {
            return 0;
        }
        var lr = getLR(this.context);
        console.log('kill debug', 'entry, lr: ' + lr, ptid, code);
        console.log('堆栈打印', '\tBacktrace:\n\t' + Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress)
            .join('\n\t'));
        return 0;
    }, 'int', ['int', 'int']));
}
/**
 * @state_name: cat /proc/xxx/stat ==> ...(<state_name>) S...
 *
 * anti fgets function include :
 * status->TracerPid, SigBlk, S (sleeping)
 * State->(package) S
 * wchan->SyS_epoll_wait
 */
function anti_fgets() {
    const tag = 'anti_fgets';
    const fgetsPtr = Module.findExportByName(null, 'fgets');
    console.log(tag, 'fgets addr: ' + fgetsPtr);
    if (null == fgetsPtr) {
        return;
    }
    var fgets = new NativeFunction(fgetsPtr, 'pointer', ['pointer', 'int', 'pointer']);
    Interceptor.replace(fgetsPtr, new NativeCallback(function (buffer, size, fp) {
        if (null == this) {
            return 0;
        }
        var logTag = null;
        // 进入时先记录现场
        const lr = getLR(this.context);
        // 读取原 buffer
        var retval = fgets(buffer, size, fp);
        // var bufstr = (buffer as NativePointer).readCString();
        var bufstr = Memory.readUtf8String(buffer);
        if (null != bufstr) {
            if (bufstr.indexOf("TracerPid:") > -1) {
                buffer.writeUtf8String("TracerPid:\t0");
                logTag = 'TracerPid';
            }
            //State:	S (sleeping)
            else if (bufstr.indexOf("State:\tt (tracing stop)") > -1) {
                buffer.writeUtf8String("State:\tS (sleeping)");
                logTag = 'State';
            }
            // ptrace_stop
            else if (bufstr.indexOf("ptrace_stop") > -1) {
                buffer.writeUtf8String("sys_epoll_wait");
                logTag = 'ptrace_stop';
            }
            //(sankuai.meituan) t
            else if (bufstr.indexOf(") t") > -1) {
                buffer.writeUtf8String(bufstr.replace(") t", ") S"));
                logTag = 'stat_t';
            }
            // SigBlk
            else if (bufstr.indexOf('SigBlk:') > -1) {
                buffer.writeUtf8String('SigBlk:\t0000000000001204');
                logTag = 'SigBlk';
            }
            if (logTag) {
                console.log(tag + " " + logTag, bufstr + " -> " + buffer.readCString() + ' lr: ' + lr +
                    "(" + getModuleByAddr(lr) + ")");
                console.log(logTag + '堆栈打印', '\tBacktrace:\n\t' + Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress)
                    .join('\n\t'));
            }
        }
        return retval;
    }, 'pointer', ['pointer', 'int', 'pointer']));
}
function anti_ptrace() {
    var ptrace = Module.findExportByName(null, "ptrace");
    if (null != ptrace) {
        ptrace = ptrace.or(1);
        console.log('anti_ptrace', "ptrace addr: " + ptrace);
        // Interceptor.attach(ptrace, {
        //     onEnter: function (args) {
        //         console.log('anti_ptrace', 'entry');
        //     }
        // });
        Interceptor.replace(ptrace.or(1), new NativeCallback(function (p1, p2, p3, p4) {
            console.log('anti_ptrace', 'entry');
            return 1;
        }, 'long', ['int', "int", 'pointer', 'pointer']));
    }
}
/**
 * 适用于每日优鲜的反调试
 */
function anti_fork() {
    var fork_addr = Module.findExportByName(null, "fork");
    console.log('anti_ptrace', "fork_addr : " + fork_addr);
    if (null != fork_addr) {
        // Interceptor.attach(fork_addr, {
        //     onEnter: function (args) {
        //         console.log('fork_addr', 'entry');
        //     }
        // });
        Interceptor.replace(fork_addr, new NativeCallback(function () {
            console.log('fork_addr', 'entry');
            return -1;
        }, 'int', []));
    }
}
function getModuleByAddr(addr) {
    var result = null;
    Process.enumerateModules().forEach(function (module) {
        if (module.base <= addr && addr <= (module.base.add(module.size))) {
            result = JSON.stringify(module);
            return false; // 跳出循环
        }
    });
    return result;
}
function getLR(context) {
    if (Process.arch == 'arm') {
        return context.lr;
    }
    else if (Process.arch == 'arm64') {
        return context.lr;
    }
    else {
        //  console.log('getLR', 'not support current arch: ' + Process.arch);
    }
    return ptr(0);
}
var aaa, bbb, ccc;
var ss = false;
Interceptor.attach(Module.findExportByName(null, "readlink"), {
    onEnter: function (args) {
        aaa = args[0];
        bbb = args[1];
        ccc = args[2];
    },
    onLeave: function (retval) {
        if (bbb.readCString().indexOf("frida") !== -1 ||
            bbb.readCString().indexOf("gum-js-loop") !== -1 ||
            bbb.readCString().indexOf("gmain") !== -1 ||
            bbb.readCString().indexOf("linjector") !== -1) {
            console.log('\nreadlink(' + 's1="' + aaa.readCString() + '"' + ', s2="' + bbb.readCString() + '"' + ', s3="' + ccc + '"' + ')');
            bbb.writeUtf8String("/system/framework/boot.art");
            console.log("replce with: " + bbb.readCString());
            retval.replace(0x1A);
            //console.log("retval: "+retval)
        }
    }
});
Interceptor.attach(Module.findExportByName(null, "strstr"), {
    onEnter: function (args) {
        if (args[0].readCString().indexOf("frida") !== -1
            || args[1].readCString().indexOf("frida") !== -1 ||
            args[0].readCString().indexOf("gum-jsloop") !== -1 || args[1].readCString().indexOf("gum-js-loop") !== -1 ||
            args[0].readCString().indexOf("gmain") !== -1
            || args[1].readCString().indexOf("gmain") !== -1 ||
            args[0].readCString().indexOf("linjector") !== -1
            || args[1].readCString().indexOf("linjector") !== -1) {
            //console.log("\nlibDexHelper.so base address:"+Module.findBaseAddress("libDexHelper.so"))
            console.log('\nstrstr(' + 's1="' + args[0].readCString() + '"' + ', s2="' + args[1].readCString() + '"' + ')');
            //console.log(Thread.backtrace(this.context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n') + '\n');
            this.frida = Boolean(1);
            //console.log("this.frida: ",this.frida);
        }
    },
    onLeave: function (retval) {
        if (this.frida) {
            retval.replace(ptr("0x0"));
        }
    }
});
const openPtr = Module.getExportByName('libc.so', 'open');
const open = new NativeFunction(openPtr, 'int', ['pointer', 'int']);
var readPtr = Module.findExportByName("libc.so", "read");
var read = new NativeFunction(readPtr, 'int', ['int', 'pointer', "int"]);
var fakePath = "/data/data/com.xingin.xhs/maps"; //这里要改包名
var file = new File(fakePath, "w");
var buffer = Memory.alloc(512);
var fakePath2 = "/data/data/com.xingin.xhs/task";
var file2 = new File(fakePath2, "w");
var buffer2 = Memory.alloc(512);
Interceptor.replace(openPtr, new NativeCallback(function (pathnameptr, flag) {
    var pathname = Memory.readUtf8String(pathnameptr);
    var realFd = open(pathnameptr, flag);
    console.log("open:", pathname);
    //路径是否包含maps 和task
    if (pathname.indexOf("maps") >= 0 || pathname.indexOf("status") >= 0 || pathname.indexOf("cmdline") >= 0) {
        var temp = pathname.indexOf("maps") >= 0 ? 1 : 2;
        //包含maps则map为1 task为2
        switch (temp) {
            case 1: //maps
                {
                    // console.log("open maps:", pathname);
                    while (parseInt(read(realFd, buffer, 512)) !== 0) {
                        var oneLine = Memory.readCString(buffer);
                        //   if(pathname=="/proc/self/maps"){
                        //     console.log("maps 打印 oneLine: ",oneLine);
                        //   }
                        if (oneLine.indexOf("tmp") === -1) {
                            // === 比== 更加严格 ==类型不匹配再转化匹配值 ===类型不匹配就是false
                            // 就是online 不包含tmp 则写入/data/data/com.wujie.chengxin/maps中
                            // 因为Frida在运行时会先确定/data/local/tmp路径下是否有re.frida.server文件夹，
                            // 若没有则创建该文件夹并存放fridaagent.so等文件
                            // console.log("write :",oneLine);
                            file.write(oneLine);
                        }
                        else {
                        }
                    }
                    console.log("外打印 maps oneLine: ", oneLine);
                    var filename = Memory.allocUtf8String(fakePath);
                    return open(filename, flag);
                    break;
                }
            case 2: //task
                {
                    console.log("open task:", pathname);
                    while (parseInt(read(realFd, buffer2, 512)) !== 0) {
                        var oneLine = Memory.readCString(buffer2);
                        console.log("打印 oneLine: ", oneLine);
                        if (oneLine.indexOf("gum-js-loop") != -1) {
                            var replaceStr = "AAAAAAAAAA";
                            oneLine = oneLine.replace("gum-js-loop", replaceStr);
                            //console.log(oneLine)
                        }
                        if (oneLine.indexOf("pool-frida") != -1) {
                            var replaceStr = "BBBBBBB";
                            oneLine = oneLine.replace("pool-frida", replaceStr);
                            //console.log(oneLine)
                        }
                        if (oneLine.indexOf("gmain") != -1) {
                            var replaceStr = "CCCCCCC"; //最终只有这里匹配上了
                            oneLine = oneLine.replace("gmain", replaceStr);
                            //console.log(oneLine)
                        }
                        file2.write(oneLine);
                    }
                    console.log("外打印 oneLine: ", oneLine);
                    var filename = Memory.allocUtf8String(fakePath2);
                    return open(filename, flag); //把伪造的路径打开返回
                    break;
                }
        }
    }
    var fd = open(pathnameptr, flag);
    // Thread.sleep(1)
    return fd;
}, 'int', ['pointer', 'int']));
export function antiFrida() {
    anti_kill();
    anti_ptrace();
    anti_fgets();
    anti_exit();
    anti_fork();
}
✄
export declare function log(message: string): void;
export declare function stacktrace_java(): any;
export declare function stacktrace_so(context: any): string;
export declare function print_byte(byte: any): any;
export declare function print_hashmap(map: any): string;
export declare function native_print(so_name: any, so_addr: any): void;
/**
 * 打印ARM64寄存器的值
 * @param {Array<string>|null} regs - 要打印的寄存器数组，不传或null则打印全部
 * @param {number} length - hexdump的长度参数，默认为5000
 */
export declare function printRegisters(context: any, regs?: null, length?: number): void;

✄
{"version":3,"file":"log.js","sourceRoot":"/home/thouger/Desktop/code/frida_script/frida_script/","sources":["src/utils/log.ts"],"names":[],"mappings":"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"}
✄
// @ts-nocheck
import { hook_dlopen, nativeHookFunction } from "../so/utils.js";
export function log(message) {
    let colorCode;
    switch (Math.floor(Math.random() * 6)) {
        case 0:
            colorCode = '\x1b[31m'; // 红色
            break;
        case 1:
            colorCode = '\x1b[32m'; // 绿色
            break;
        case 2:
            colorCode = '\x1b[33m'; // 黄色
            break;
        case 3:
            colorCode = '\x1b[35m'; // 紫色
            break;
        case 4:
            colorCode = '\x1b[36m'; // 青色
            break;
        case 5:
            colorCode = '\x1b[37m'; // 白色
            break;
        default:
            colorCode = '';
            break;
    }
    console.log(`${colorCode}${message}\x1b[0m`);
}
export function stacktrace_java() {
    return Java.use("android.util.Log").getStackTraceString(Java.use("java.lang.Throwable").$new());
}
export function stacktrace_so(context) {
    return 'stacktrace_so called from:\n' + Thread.backtrace(context, Backtracer.ACCURATE).map(DebugSymbol.fromAddress).join('\n') + '\n';
}
export function print_byte(byte) {
    var str = Java.use("java.lang.String").$new(byte);
    return str;
}
export function print_hashmap(map) {
    var result = "";
    var HashMapNode = Java.use("java.util.HashMap$Node");
    var iterator = map.entrySet().iterator();
    while (iterator.hasNext()) {
        console.log("entry", iterator.next());
        var entry = Java.cast(iterator.next(), HashMapNode);
        console.log(entry.getKey());
        console.log(entry.getValue());
        result += entry.getValue();
    }
    console.log("result is :", result);
    return result;
}
export function native_print(so_name, so_addr) {
    function hexdumpMem(addr) {
        if (Process.findRangeByAddress(addr)) {
            return hexdump(ptr(addr), { length: 0x40 }) + "\r\n";
        }
        else {
            return ptr(addr) + "\r\n";
        }
    }
    nativeHookFunction(so_name, so_addr);
    hook_dlopen(so_name, nativeHookFunction, so_addr);
}
/**
 * 打印ARM64寄存器的值
 * @param {Array<string>|null} regs - 要打印的寄存器数组，不传或null则打印全部
 * @param {number} length - hexdump的长度参数，默认为5000
 */
export function printRegisters(context, regs = null, length = 5000) {
    // 定义ARM64架构中的所有通用寄存器
    const allRegisters = [
        "x0", "x1", "x2", "x3", "x4", "x5", "x6", "x7",
        "x8", "x9", "x10", "x11", "x12", "x13", "x14", "x15",
        "x16", "x17", "x18", "x19", "x20", "x21", "x22", "x23",
        "x24", "x25", "x26", "x27", "x28", "x29", "x30", "sp", "pc"
    ];
    // 如果没有指定寄存器，则使用所有寄存器
    const registersToPrint = regs || allRegisters;
    // 遍历并打印每个寄存器的值
    for (let i = 0; i < registersToPrint.length; i++) {
        const reg = registersToPrint[i];
        try {
            // 根据是否提供length参数，决定调用hexdump的方式
            if (length !== null) {
                log(reg + ":" + hexdump(context[reg], { length: length }));
            }
            else {
                log(reg + ":" + hexdump(context[reg]));
            }
        }
        catch (error) {
            log("无法打印寄存器 " + reg + ": " + error.message);
        }
    }
}
// 使用示例:
// 1. 打印所有寄存器(默认长度5000)
// printRegisters();
// 2. 只打印特定寄存器
// printRegisters(["x0", "x1", "x2"]);
// 3. 使用自定义长度打印特定寄存器
// printRegisters(["x2", "x8"], 1000);
// 4. 使用默认寄存器列表，但自定义长度
// printRegisters(null, 2000);
// 或者
// printRegisters(undefined, 2000);